<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ â€“ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª</title>
<style>
  :root {
    --bg:#f7f8fb; --ink:#111; --muted:#666; --line:#e5e7eb; --card:#fff; --accent:#2563eb;
  }
  * { box-sizing:border-box; }
  body { margin:0; background:var(--bg); color:var(--ink); font-family:"Noto Kufi Arabic","Cairo",Tahoma,Arial,sans-serif; }
  .wrap { max-width:1100px; margin:auto; padding:20px; }
  .card { background:var(--card); border:1px solid #ddd; border-radius:14px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,.05); }
  h1 { text-align:center; color:#2563eb; font-size:22px; margin-bottom:15px; }
  h2 { font-size:18px; margin:12px 0; color:#333; }
  label { font-size:14px; display:block; margin-top:8px; }
  input[type=text], input[type=date], select { width:100%; padding:10px; border:1px solid var(--line); border-radius:10px; background:#fff; }
  textarea { width:100%; padding:10px; border:1px solid var(--line); border-radius:10px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:right; }
  th { background:#eef2ff; }
  .toolbar { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
  .btn { padding:10px 14px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer; font-size:14px; }
  .btn.primary { background:#2563eb; color:#fff; border-color:#2563eb; }
  .btn.warn { background:#fee2e2; border-color:#fecaca; }
  .hidden { display:none !important; }
  .muted { color:var(--muted); font-size:13px; }
  .pill { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border:1px solid #ddd; border-radius:999px; background:#fff; font-size:12px; }
  .logo { height:60px; object-fit:contain; }
  @media print {
    .no-print { display:none !important; }
    body { background:#fff; }
    .card { box-shadow:none; border:0; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="admin">
    <h1>ğŸ§¾ Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</h1>
    <div class="muted">Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŒ Ø£Ø¶Ù Ø§Ù„Ø¨Ù†ÙˆØ¯ØŒ Ø«Ù… Ø£Ù†Ø´Ø¦ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.</div>

    <div class="toolbar">
      <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø¨ <input id="gateNo" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 3"></label>
      <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨ <input id="gateName" type="text" placeholder="Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¢Ù„Ø§Øª"></label>
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… <input id="todayInput" type="date"></label>
    </div>

    <div class="toolbar">
      <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ <input id="clientName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"></label>
      <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ <input id="siteName" type="text" placeholder="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„"></label>
    </div>

    <div class="toolbar">
      <button class="btn" id="addRow">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>
      <button class="btn" id="selectAll">âœ”ï¸ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
      <button class="btn" id="clearAll">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
      <button class="btn primary" id="saveDraft">ğŸ’¾ Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©</button>
      <button class="btn warn" id="reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    </div>

    <table>
      <thead>
        <tr><th>ØªØ¶Ù…ÙŠÙ†</th><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</th><th>Ø­Ø°Ù</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="toolbar">
      <button class="btn primary" id="makeClient">ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
      <button class="btn" id="exportHTML">â¬‡ï¸ ØªØµØ¯ÙŠØ± HTML</button>
    </div>
  </div>

  <div class="card hidden" id="client">
    <h1>âœ… Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ â€“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚</h1>
    <div id="meta" class="muted"></div>

    <div class="toolbar">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ù‚Ù‚ <input id="auditorName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ù‚Ù‚"></label>
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØªÙŠØ´ <input id="inspectDate" type="date"></label>
    </div>

    <h2>Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ø§</h2>
    <form id="clientForm"></form>

    <div class="toolbar no-print">
      <button class="btn primary" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      <button class="btn" id="sendWA">ğŸ“² ÙˆØ§ØªØ³Ø§Ø¨</button>
      <button class="btn" id="sendEmail">âœ‰ï¸ Ø¥ÙŠÙ…ÙŠÙ„</button>
      <button class="btn" id="back">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>
</div>

<script>
const els = {
  tbody: document.getElementById('tbody'), gateNo: gateNo, gateName: gateName, todayInput: todayInput,
  clientName: clientName, siteName: siteName, makeClient: makeClient, clientForm: clientForm,
  admin: admin, client: client, meta: meta, auditorName: auditorName, inspectDate: inspectDate,
  printBtn: printBtn, sendWA: sendWA, sendEmail: sendEmail, back: back, saveDraft: saveDraft, reset: reset
};
const state = { rows: [] };

function uid(){ return Math.random().toString(36).slice(2); }
function render(){
  els.tbody.innerHTML = '';
  state.rows.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><input type='checkbox' class='pick' ${r.pick?'checked':''} data-id='${r.id}'></td>
      <td contenteditable='true' class='txt' data-id='${r.id}'>${r.text}</td>
      <td><select class='kind' data-id='${r.id}'><option value='yn' ${r.kind==='yn'?'selected':''}>ØµØ­/Ø®Ø·Ø£</option><option value='rate' ${r.kind==='rate'?'selected':''}>ØªÙ‚ÙŠÙŠÙ… 1â€“5</option></select></td>
      <td><button class='btn warn del' data-id='${r.id}'>Ø­Ø°Ù</button></td>`;
    els.tbody.appendChild(tr);
  });
}

function save(){ localStorage.setItem('client_draft', JSON.stringify(state.rows)); }
function load(){ const s = localStorage.getItem('client_draft'); if(!s) return; state.rows = JSON.parse(s); render(); }

addRow.onclick = ()=>{ state.rows.unshift({id:uid(), text:'* Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯', pick:true, kind:'yn'}); render(); save(); };
selectAll.onclick = ()=>{ state.rows.forEach(r=>r.pick=true); render(); save(); };
clearAll.onclick = ()=>{ state.rows.forEach(r=>r.pick=false); render(); save(); };

els.tbody.addEventListener('input', e=>{ const id=e.target.dataset.id; const r=state.rows.find(r=>r.id===id); if(!r)return; if(e.target.classList.contains('txt'))r.text=e.target.innerText; save(); });
els.tbody.addEventListener('change', e=>{ const id=e.target.dataset.id; const r=state.rows.find(r=>r.id===id); if(!r)return; if(e.target.classList.contains('pick'))r.pick=e.target.checked; if(e.target.classList.contains('kind'))r.kind=e.target.value; save(); });
els.tbody.addEventListener('click', e=>{ if(e.target.classList.contains('del')){ const id=e.target.dataset.id; state.rows=state.rows.filter(r=>r.id!==id); render(); save(); }});

els.makeClient.onclick=()=>{
  const selected = state.rows.filter(r=>r.pick);
  if(!selected.length) return alert('Ø§Ø®ØªØ± Ø¨Ù†Ø¯Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
  els.meta.textContent = `Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø¨ ${els.gateNo.value} â€“ ${els.gateName.value} | Ø§Ù„Ø¹Ù…ÙŠÙ„: ${els.clientName.value} | Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${els.siteName.value}`;
  els.clientForm.innerHTML = '';
  selected.forEach((r,i)=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<strong>${i+1}. ${r.text}</strong><br>
      ${(r.kind==='yn')?
        '<label><input type=radio name=f'+i+'> ØµØ­</label> <label><input type=radio name=f'+i+'> Ø®Ø·Ø£</label>':
        '<select><option>â€”</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>'}
      <br><input type=text maxlength=50 placeholder='Ù…Ù„Ø§Ø­Ø¸Ø© (50 Ø­Ø±Ù)'>`;
    els.clientForm.appendChild(div);
  });
  els.admin.classList.add('hidden'); els.client.classList.remove('hidden');
};

els.back.onclick=()=>{ els.client.classList.add('hidden'); els.admin.classList.remove('hidden'); };
els.printBtn.onclick=()=>window.print();
els.sendWA.onclick=()=>{ const txt='Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„\n'+els.meta.textContent; window.open('https://wa.me/?text='+encodeURIComponent(txt),'_blank'); };
els.sendEmail.onclick=()=>{ const sub='Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„'; const body=els.meta.textContent; location.href=`mailto:ergonomicindustrial@gmail.com?subject=${encodeURIComponent(sub)}&body=${encodeURIComponent(body)}`; };
els.saveDraft.onclick=()=>{ save(); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); };
els.reset.onclick=()=>{ localStorage.removeItem('client_draft'); state.rows=[]; render(); };

load();
</script>
</body>
</html>
