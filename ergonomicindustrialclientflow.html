<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ â€“ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø§ØªÙØ§Ù‚ (âœ“ / âœ— + Ù…Ù„Ø§Ø­Ø¸Ø§Øª â‰¤50)</title>
<style>
  :root{--bg:#f7f8fb;--ink:#111;--muted:#666;--line:#e5e7eb;--card:#fff;--accent:#2563eb;--head:#e6f0ff}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Kufi Arabic","Cairo",Tahoma,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:18px}
  .sheet{background:var(--card);border:1px solid #d9dde5;border-radius:14px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
  .title{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:8px}
  .logo{height:64px;object-fit:contain}
  h1{margin:.2rem 0 .6rem;font-size:22px}
  .meta{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:420px;margin-inline-start:auto}
  .meta label{display:flex;gap:6px;align-items:center;font-size:14px;color:#333}
  .meta input{flex:1;padding:8px;border:1px solid var(--line);border-radius:10px;background:#fff}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid #cfd7e3;padding:8px;vertical-align:middle}
  th{background:var(--head);text-align:center}
  td.num{width:48px;text-align:center}
  td.chk{text-align:center;width:46px}
  td.note input{width:100%;padding:8px;border:1px solid var(--line);border-radius:8px}
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #d0d7ff;background:#fff;cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .muted{color:var(--muted);font-size:13px}
  .box{border:1px dashed #cfd7e3;border-radius:10px;padding:10px;margin:8px 0}
  .hidden{display:none!important}
  @media print{.no-print{display:none!important}.sheet{border:0;box-shadow:none}body{background:#fff}}
</style>
</head>
<body>
<div class="wrap">
  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ (Ø§Ù„Ù…ØµÙ…Ù…) -->
  <div id="setup" class="sheet">
    <div class="title">
      <img id="lg" class="logo" alt="logo" hidden>
      <h1>ğŸ§¾ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯ â€“ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</h1>
    </div>
    <div class="box">
      <div class="muted">**Ø§Ù„ÙˆØ±Ùƒ ÙÙ„Ùˆ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡**: Ù…Ù†ÙŠ ÙƒÙ…ØµÙ…Ù… âœ Ø§Ù„Ø¹Ù…ÙŠÙ„ âœ Ø§Ù„Ù…Ø¯Ù‚Ù‚ âœ Ø§Ù„Ø¹Ù…ÙŠÙ„ âœ Ø£Ø±Ø¬Ø¹ Ù„ÙŠ. Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø³ØªØ­ØªÙˆÙŠ ÙÙ‚Ø· Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙŠ Ø£Ø­Ø¯Ø¯Ù‡Ø§ Ù‡Ù†Ø§.</div>
    </div>

    <div class="toolbar">
      <label class="btn no-print"><input type="file" id="logoInput" accept="image/*"> Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±</label>
      <button class="btn" id="addRow">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>
      <button class="btn" id="selectAll">âœ”ï¸ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
      <button class="btn" id="clearAll">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
      <button class="btn" id="save">ğŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
      <button class="btn" id="reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
      <span class="muted">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù†Øµ Ø§Ù„Ø¨Ù†Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</span>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:74px">ØªØ¶Ù…ÙŠÙ†</th>
          <th>Ù†Øµ Ø§Ù„Ø¨Ù†Ø¯</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="toolbar">
      <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø¨ <input id="gateNo" type="text" placeholder="1"></label>
      <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨ <input id="gateName" type="text" placeholder="Ø§Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©"></label>
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± <input id="issueDate" type="date"></label>
      <button class="btn primary" id="build">ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
      <button class="btn" id="exportHtml">â¬‡ï¸ ØªØµØ¯ÙŠØ± HTML Ù„Ù„Ø¹Ù…ÙŠÙ„</button>
    </div>
  </div>

  <!-- Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (âœ“ / âœ— + Ù…Ù„Ø§Ø­Ø¸Ø© â‰¤ 50) -->
  <div id="client" class="sheet hidden">
    <div class="title">
      <img id="lg2" class="logo" alt="logo" hidden>
      <h1 id="titleTxt">Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â€“ Ø§Ù„Ø¨Ø§Ø¨</h1>
    </div>

    <div class="meta">
      <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: <input id="cClient" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"></label>
      <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹: <input id="cSite" type="text" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹"></label>
      <label>Ø§Ù„Ù…Ø¯Ù‚Ù‚: <input id="cAuditor" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ù‚Ù‚"></label>
      <label>Ø§Ù„ØªØ§Ø±ÙŠØ®: <input id="cDate" type="date"></label>
    </div>

    <table id="clientTable">
      <thead>
        <tr>
          <th>Ù…</th>
          <th>Ø§Ù„Ø¨Ù†Ø¯</th>
          <th>âœ“</th>
          <th>âœ—</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="clientBody"></tbody>
    </table>

    <div class="toolbar no-print">
      <button class="btn primary" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      <button class="btn" id="waBtn">ğŸ“² Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</button>
      <button class="btn" id="mailBtn">âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯</button>
      <button class="btn" id="back">â†©ï¸ Ø±Ø¬ÙˆØ¹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = s=>document.querySelector(s);
  const els = {
    setup: $('#setup'), client: $('#client'),
    lg: $('#lg'), lg2: $('#lg2'), logoInput: $('#logoInput'),
    tbody: $('#tbody'), addRow: $('#addRow'), selectAll: $('#selectAll'), clearAll: $('#clearAll'),
    save: $('#save'), reset: $('#reset'), gateNo: $('#gateNo'), gateName: $('#gateName'), issueDate: $('#issueDate'),
    build: $('#build'), exportHtml: $('#exportHtml'),
    titleTxt: $('#titleTxt'), cClient: $('#cClient'), cSite: $('#cSite'), cAuditor: $('#cAuditor'), cDate: $('#cDate'),
    clientBody: $('#clientBody'), printBtn: $('#printBtn'), waBtn: $('#waBtn'), mailBtn: $('#mailBtn'), back: $('#back')
  };
  const today = new Date().toISOString().slice(0,10);
  els.issueDate.value = today; els.cDate.value = today;

  let logoData = '';
  let rows = []; // {id,text,include}

  function uid(){return Math.random().toString(36).slice(2)}
  function persist(){ localStorage.setItem('agreed_client_rows', JSON.stringify({logoData, rows, gateNo:els.gateNo.value, gateName:els.gateName.value, issueDate:els.issueDate.value})); }
  function load(){
    const s = localStorage.getItem('agreed_client_rows'); if(!s) return;
    try{ const d = JSON.parse(s); logoData=d.logoData||''; rows=Array.isArray(d.rows)?d.rows:[]; if(logoData){els.lg.src=logoData;els.lg.hidden=false}
      els.gateNo.value=d.gateNo||''; els.gateName.value=d.gateName||''; els.issueDate.value=d.issueDate||today; renderSetup(); }catch(e){}
  }

  function renderSetup(){
    els.tbody.innerHTML='';
    rows.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td style="width:74px;text-align:center"><input type="checkbox" class="pick" data-id="${r.id}" ${r.include?'checked':''}></td>
                    <td contenteditable class="txt" data-id="${r.id}">${r.text}</td>`;
      els.tbody.appendChild(tr);
    });
  }

  function addRow(text){ rows.push({id:uid(), text:text||'* Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯', include:true}); renderSetup(); persist(); }

  els.addRow.onclick=()=>addRow();
  els.selectAll.onclick=()=>{ rows.forEach(r=>r.include=true); renderSetup(); persist(); };
  els.clearAll.onclick=()=>{ rows.forEach(r=>r.include=false); renderSetup(); persist(); };
  els.tbody.addEventListener('input', e=>{ const id=e.target.dataset.id; const r=rows.find(x=>x.id===id); if(!r) return; r.text=e.target.innerText.trim(); persist(); });
  els.tbody.addEventListener('change', e=>{ if(e.target.classList.contains('pick')){ const id=e.target.dataset.id; const r=rows.find(x=>x.id===id); if(r){ r.include=e.target.checked; persist(); } }});

  els.logoInput.addEventListener('change', e=>{
    const f=e.target.files[0]; if(!f){logoData=''; els.lg.hidden=true; return;}
    const rd=new FileReader(); rd.onload=ev=>{logoData=ev.target.result; els.lg.src=logoData; els.lg.hidden=false; persist();}; rd.readAsDataURL(f);
  });

  els.save.onclick=()=>{persist(); alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§');};
  els.reset.onclick=()=>{ if(confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')){ localStorage.removeItem('agreed_client_rows'); rows=[]; logoData=''; els.lg.hidden=true; renderSetup(); } };

  // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
  els.build.onclick=()=>{
    const list = rows.filter(r=>r.include && r.text.trim());
    if(!list.length) return alert('Ø§Ø®ØªØ± Ø¨Ù†Ø¯Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
    els.titleTxt.textContent = `Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â€“ Ø§Ù„Ø¨Ø§Ø¨ ${els.gateNo.value||'-'} â€“ ${els.gateName.value||''}`;
    els.clientBody.innerHTML='';
    if(logoData){els.lg2.src=logoData; els.lg2.hidden=false}else{els.lg2.hidden=true}

    list.forEach((r,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `<td class="num">${i+1}</td>
                      <td>${r.text}</td>
                      <td class="chk"><input type="checkbox" name="ok_${i}" class="ok"></td>
                      <td class="chk"><input type="checkbox" name="no_${i}" class="no"></td>
                      <td class="note"><input type="text" maxlength="50" placeholder="Ø­ØªÙ‰ 50 Ø­Ø±ÙÙ‹Ø§"></td>`;
      els.clientBody.appendChild(tr);
    });

    // Ø§Ø¬Ø¹Ù„ âœ“ Ùˆ âœ— Ù…ØªÙ†Ø§ÙÙŠÙŠÙ† Ù„ÙƒÙ„ ØµÙ
    els.clientBody.querySelectorAll('tr').forEach(tr=>{
      const ok=tr.querySelector('.ok'); const no=tr.querySelector('.no');
      ok.addEventListener('change',()=>{ if(ok.checked) no.checked=false; });
      no.addEventListener('change',()=>{ if(no.checked) ok.checked=false; });
    });

    els.setup.classList.add('hidden');
    els.client.classList.remove('hidden');
  };

  // ØªØµØ¯ÙŠØ± HTML Ø«Ø§Ø¨Øª Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ù†ÙØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±Ø¨Øª)
  els.exportHtml.onclick=()=>{
    const list = rows.filter(r=>r.include && r.text.trim());
    if(!list.length) return alert('Ø§Ø®ØªØ± Ø¨Ù†Ø¯Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
    const safe=s=>String(s).replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]));
    const rowsHtml=list.map((r,i)=>`<tr><td style="text-align:center">${i+1}</td><td>${safe(r.text)}</td><td>â˜</td><td>â˜</td><td></td></tr>`).join('');
    const html=`<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
      <style>body{font-family:Tahoma,Arial;margin:0;background:#f7f8fb;color:#111} .wrap{max-width:900px;margin:auto;padding:16px} .card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px} h2{text-align:center} table{width:100%;border-collapse:collapse;margin-top:10px} th,td{border:1px solid #ccc;padding:8px;text-align:center} th{background:#e6f0ff}</style></head>
      <body><div class="wrap"><div class="card">${logoData?`<div style="text-align:center"><img src="${logoData}" style="height:60px"></div>`:''}
      <h2>Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â€“ Ø§Ù„Ø¨Ø§Ø¨ ${safe(els.gateNo.value||'-')} â€“ ${safe(els.gateName.value||'')}</h2>
      <table><thead><tr><th>Ù…</th><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>âœ“</th><th>âœ—</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead><tbody>${rowsHtml}</tbody></table>
      <div style="margin-top:12px">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: __________ | Ø§Ù„Ù…ÙˆÙ‚Ø¹: __________ | Ø§Ù„Ù…Ø¯Ù‚Ù‚: __________ | Ø§Ù„ØªØ§Ø±ÙŠØ®: __________</div></div></div></body></html>`;
    const blob=new Blob([html],{type:'text/html'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='Ù†Ø³Ø®Ø©-Ø§Ù„Ø¹Ù…ÙŠÙ„.html'; a.click(); URL.revokeObjectURL(url);
  };

  // Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  function summaryTxt(){
    const lines=[]; lines.push(els.titleTxt.textContent);
    lines.push(`Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${els.cClient.value||'-'} | Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${els.cSite.value||'-'} | Ø§Ù„Ù…Ø¯Ù‚Ù‚: ${els.cAuditor.value||'-'} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${els.cDate.value||'-'}`);
    lines.push('---');
    els.clientBody.querySelectorAll('tr').forEach((tr,i)=>{
      const item=tr.children[1].textContent.trim();
      const ok=tr.querySelector('.ok').checked? 'âœ“':'-';
      const no=tr.querySelector('.no').checked? 'âœ—':'-';
      const note=tr.querySelector('input[type="text"]').value.trim();
      lines.push(`${i+1}) ${item} | ${ok}/${no}${note? ' | Ù…Ù„Ø§Ø­Ø¸Ø©: '+note:''}`);
    });
    return lines.join('
');
  }

  els.printBtn.onclick=()=>window.print();
  els.waBtn.onclick=()=>{ const url='https://wa.me/?text='+encodeURIComponent(summaryTxt()); window.open(url,'_blank'); };
  els.mailBtn.onclick=()=>{ const sub='Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„'; const body=summaryTxt(); location.href=`mailto:ergonomicindustrial@gmail.com?subject=${encodeURIComponent(sub)}&body=${encodeURIComponent(body)}`; };
  els.back.onclick=()=>{ els.client.classList.add('hidden'); els.setup.classList.remove('hidden'); };

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø£ÙˆÙ„ Ù…Ø±Ø©
  function seed(){ if(rows.length) return; ['Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ù„ÙŠÙ„ Ø¥Ø±Ø´Ø§Ø¯ÙŠ Ù„Ù„Ø³Ù„Ø§Ù…Ø©','ØªØ­Ø¯ÙŠØ¯ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù…Ù„','ØªÙˆÙÙŠØ± Ù…Ø¹Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ©','ÙØ­Øµ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø¥Ø·ÙØ§Ø¡ ÙˆØµÙ„Ø§Ø­ÙŠØªÙ‡Ø§'].forEach(t=>addRow(t)); }
  load(); seed();
})();
</script>
</body>
</html>
