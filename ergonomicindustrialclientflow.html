# Create two ready-to-use HTML files:
# 1) Standalone (works locally in any browser) with full features.
# 2) Static client-only fallback (no JavaScript build; fill & print/send).

from pathlib import Path

standalone_html = """<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>نسخة العميل – إصدار مستقل (كامل المزايا)</title>
<style>
  :root{--bg:#f7f8fb;--ink:#111;--muted:#666;--line:#e5e7eb;--card:#fff;--accent:#2563eb}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Kufi Arabic","Cairo",Tahoma,Arial,sans-serif}
  .wrap{max-width:1100px;margin:auto;padding:16px}
  .card{background:var(--card);border:1px solid #ddd;border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .row{display:grid;gap:12px}
  @media(min-width:768px){.row{grid-template-columns:repeat(12,1fr)}.col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-8{grid-column:span 8}.col-12{grid-column:span 12}}
  h1{margin:.3rem 0 1rem;font-size:22px}
  h2{margin:1rem 0 .5rem;font-size:18px}
  label{font-size:14px;color:#333}
  input[type="text"], input[type="date"], select, textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
  textarea{min-height:72px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border:1px solid #e5e7eb;padding:8px;vertical-align:top}
  th{background:#eef2ff}
  .muted{color:var(--muted);font-size:13px}
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
  .btn{padding:10px 14px;border-radius:12px;border:1px solid #cfd8ff;background:#fff;cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .btn.ghost{background:#fff;border:1px solid #ddd}
  .btn.warn{background:#fee2e2;border-color:#fecaca}
  .center{display:flex;align-items:center;gap:10px}
  .pill{display:inline-flex;gap:6px;align-items:center;padding:4px 10px;border:1px solid #ddd;border-radius:999px;background:#fff;font-size:12px}
  .logo{height:64px;object-fit:contain}
  .hidden{display:none !important}
  .hr{height:1px;background:var(--line);margin:10px 0}
  .notice{background:#fef9c3;border:1px solid #fde68a;color:#854d0e;padding:10px;border-radius:10px;font-size:13px}
  .badge{background:#e5edff;color:#1e3a8a;border-radius:999px;padding:2px 8px;font-size:12px}
  @media print{.no-print{display:none !important} body{background:#fff} .card{border:0;box-shadow:none} a[href]:after{content:"" !important}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="admin">
    <div class="row">
      <div class="col-12 center" style="justify-content:space-between;gap:16px;flex-wrap:wrap">
        <div class="center" style="gap:12px">
          <img id="logo" class="logo" alt="logo" hidden>
          <div>
            <h1>🧾 لوحة إعداد <span class="badge">نسخة العميل</span></h1>
            <div class="muted">أدخل البيانات، اختر البنود، ثم اضغط “إنشاء نسخة العميل”. يعمل على المتصفح والهاتف والتابلت (Android / iOS) بدون إنترنت.</div>
          </div>
        </div>
        <label class="pill no-print"><input type="file" id="logoInput" accept="image/*"> شعار الشركة</label>
      </div>
    </div>

    <div class="row">
      <div class="col-3"><label>رقم الباب<br><input id="gateNo" type="text" placeholder="مثل: 3"></label></div>
      <div class="col-6"><label>اسم الباب<br><input id="gateName" type="text" placeholder="الحماية من الآلات"></label></div>
      <div class="col-3"><label>تاريخ اليوم<br><input id="todayInput" type="date"></label></div>
    </div>

    <div class="row" style="margin-top:8px">
      <div class="col-6"><label>اسم العميل<br><input id="clientName" type="text" placeholder="اسم العميل"></label></div>
      <div class="col-6"><label>اسم الموقع<br><input id="siteName" type="text" placeholder="موقع العمل"></label></div>
    </div>

    <div class="toolbar no-print">
      <button class="btn ghost" id="addRow">➕ إضافة بند</button>
      <button class="btn ghost" id="selectAll">✔️ تحديد الكل</button>
      <button class="btn ghost" id="clearAll">❌ إلغاء التحديد</button>
      <span class="pill">نوع الاستجابة الافتراضي:
        <select id="defaultResp">
          <option value="yn">صح/خطأ</option>
          <option value="rate">تقييم 1–5</option>
        </select>
      </span>
      <span class="pill">بحث: <input id="filter" type="text" placeholder="فلتر البنود" style="border:0"></span>
      <button class="btn" id="saveDraft">💾 حفظ كمسودة (محلي)</button>
      <button class="btn warn" id="reset">إعادة التعيين</button>
    </div>

    <div class="notice no-print">ملاحظة: "ملاحظة العميل" في النسخة النهائية محددة بـ 50 حرفًا تلقائيًا.</div>

    <table id="adminTable">
      <thead>
        <tr>
          <th style="width:80px">تضمين</th>
          <th>نص البند (قابل للتعديل)</th>
          <th style="width:160px">نوع الاستجابة</th>
          <th style="width:60px">حذف</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="toolbar no-print">
      <button class="btn primary" id="makeClient">🚀 إنشاء نسخة العميل</button>
      <button class="btn" id="exportHTML">⬇️ تصدير نسخة HTML</button>
      <span class="muted">سيتم تضمين فقط الصفوف المحددة.</span>
    </div>
  </div>

  <div class="card hidden" id="client">
    <div class="center" style="justify-content:space-between;gap:16px;flex-wrap:wrap">
      <div class="center" style="gap:12px">
        <img id="logoClient" class="logo" alt="logo" hidden>
        <div>
          <h1>✅ نسخة العميل – قائمة التدقيق</h1>
          <div class="muted" id="meta"></div>
        </div>
      </div>
      <span class="pill">التاريخ: <span id="clientDate"></span></span>
    </div>

    <div class="hr"></div>

    <div class="row">
      <div class="col-6"><label>اسم المدقق<br><input id="auditorName" type="text" placeholder="اسم المدقق"></label></div>
      <div class="col-6"><label>تاريخ التفتيش<br><input id="inspectDate" type="date"></label></div>
    </div>

    <h2> البنود المطلوب التحقق منها</h2>
    <form id="clientForm"></form>

    <div class="toolbar no-print">
      <button class="btn primary" id="printBtn">🖨️ طباعة</button>
      <button class="btn" id="sendWA">📲 إرسال عبر واتساب</button>
      <button class="btn" id="sendEmail">✉️ إرسال عبر البريد</button>
      <button class="btn ghost" id="backToAdmin">↩️ تعديل الإعدادات</button>
    </div>
  </div>
</div>

<script>
  const els = {
    logo: document.getElementById('logo'),
    logoClient: document.getElementById('logoClient'),
    logoInput: document.getElementById('logoInput'),
    gateNo: document.getElementById('gateNo'),
    gateName: document.getElementById('gateName'),
    todayInput: document.getElementById('todayInput'),
    clientName: document.getElementById('clientName'),
    siteName: document.getElementById('siteName'),
    defaultResp: document.getElementById('defaultResp'),
    tbody: document.getElementById('tbody'),
    addRow: document.getElementById('addRow'),
    selectAll: document.getElementById('selectAll'),
    clearAll: document.getElementById('clearAll'),
    filter: document.getElementById('filter'),
    saveDraft: document.getElementById('saveDraft'),
    reset: document.getElementById('reset'),
    makeClient: document.getElementById('makeClient'),
    exportHTML: document.getElementById('exportHTML'),
    admin: document.getElementById('admin'),
    client: document.getElementById('client'),
    clientForm: document.getElementById('clientForm'),
    meta: document.getElementById('meta'),
    clientDate: document.getElementById('clientDate'),
    auditorName: document.getElementById('auditorName'),
    inspectDate: document.getElementById('inspectDate'),
    printBtn: document.getElementById('printBtn'),
    sendWA: document.getElementById('sendWA'),
    sendEmail: document.getElementById('sendEmail'),
    backToAdmin: document.getElementById('backToAdmin')
  };

  const state = {
    logoDataURL: '',
    rows: [],
  };

  const todayISO = new Date().toISOString().slice(0,10);
  els.todayInput.value = todayISO;

  function uid(){return Math.random().toString(36).slice(2)}

  function persist(){
    const draft = {
      logo: state.logoDataURL,
      gateNo: els.gateNo.value,
      gateName: els.gateName.value,
      date: els.todayInput.value,
      clientName: els.clientName.value,
      siteName: els.siteName.value,
      defaultResp: els.defaultResp.value,
      rows: state.rows
    };
    localStorage.setItem('client_version_draft', JSON.stringify(draft));
  }

  function loadDraft(){
    const s = localStorage.getItem('client_version_draft');
    if(!s) return;
    try{
      const d = JSON.parse(s);
      state.logoDataURL = d.logo||'';
      if(state.logoDataURL){ els.logo.src = state.logoDataURL; els.logo.hidden=false; }
      els.gateNo.value = d.gateNo||'';
      els.gateName.value = d.gateName||'';
      els.todayInput.value = d.date||todayISO;
      els.clientName.value = d.clientName||'';
      els.siteName.value = d.siteName||'';
      els.defaultResp.value = d.defaultResp||'yn';
      state.rows = Array.isArray(d.rows)? d.rows:[];
      renderTable();
    }catch(e){console.warn('draft parse', e)}
  }

  function renderTable(){
    const q = els.filter.value.trim();
    els.tbody.innerHTML = '';
    state.rows
      .filter(r=>!q || r.text.includes(q))
      .forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td style="text-align:center"><input type="checkbox" class="inc" ${r.include? 'checked':''} data-id="${r.id}"></td>
          <td contenteditable="true" class="txt" data-id="${r.id}">${r.text}</td>
          <td>
            <select class="kind" data-id="${r.id}">
              <option value="yn" ${r.kind==='yn'?'selected':''}>صح/خطأ</option>
              <option value="rate" ${r.kind==='rate'?'selected':''}>تقييم 1–5</option>
            </select>
          </td>
          <td style="text-align:center"><button class="btn warn del no-print" data-id="${r.id}">حذف</button></td>`;
        els.tbody.appendChild(tr);
      });
  }

  function addRow(text){
    state.rows.unshift({id:uid(), include:true, text:text||'* بند جديد', kind: els.defaultResp.value});
    renderTable();
    persist();
  }

  els.logoInput.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(!file){ state.logoDataURL=''; els.logo.hidden=true; return; }
    const r = new FileReader();
    r.onload = ev=>{ state.logoDataURL = ev.target.result; els.logo.src = state.logoDataURL; els.logo.hidden=false; persist(); };
    r.readAsDataURL(file);
  });

  els.addRow.onclick = ()=> addRow();
  els.selectAll.onclick = ()=>{ state.rows.forEach(r=>r.include=true); renderTable(); persist(); };
  els.clearAll.onclick = ()=>{ state.rows.forEach(r=>r.include=false); renderTable(); persist(); };

  els.tbody.addEventListener('input', e=>{
    const id = e.target.getAttribute('data-id');
    const row = state.rows.find(r=>r.id===id);
    if(!row) return;
    if(e.target.classList.contains('txt')) row.text = e.target.innerText.trim();
    if(e.target.classList.contains('kind')) row.kind = e.target.value;
    persist();
  });
  els.tbody.addEventListener('change', e=>{
    const id = e.target.getAttribute('data-id');
    const row = state.rows.find(r=>r.id===id);
    if(!row) return;
    if(e.target.classList.contains('inc')) row.include = e.target.checked;
    persist();
  });
  els.tbody.addEventListener('click', e=>{
    if(e.target.classList.contains('del')){
      const id = e.target.getAttribute('data-id');
      state.rows = state.rows.filter(r=>r.id!==id); renderTable(); persist();
    }
  });

  els.filter.addEventListener('input', renderTable);

  els.saveDraft.onclick = ()=>{ persist(); alert('تم الحفظ محليًا.'); };
  els.reset.onclick = ()=>{
    if(!confirm('إعادة التعيين ستفرّغ كل البيانات المخزنة محليًا. هل أنت متأكد؟')) return;
    localStorage.removeItem('client_version_draft');
    state.rows = []; els.logo.hidden=true; state.logoDataURL='';
    els.gateNo.value=els.gateName.value=els.clientName.value=els.siteName.value='';
    els.defaultResp.value='yn'; els.todayInput.value=todayISO; renderTable();
  };

  els.makeClient.onclick = ()=>{
    const selected = state.rows.filter(r=>r.include && r.text.trim());
    if(selected.length===0){ alert('اختر بندًا واحدًا على الأقل.'); return; }

    els.meta.textContent = `رقم الباب ${els.gateNo.value||'-'} – ${els.gateName.value||'-'} | العميل: ${els.clientName.value||'-'} | الموقع: ${els.siteName.value||'-'}`;
    els.clientDate.textContent = els.todayInput.value || todayISO;

    if(state.logoDataURL){ els.logoClient.src = state.logoDataURL; els.logoClient.hidden=false; }
    else { els.logoClient.hidden=true; }

    els.clientForm.innerHTML = '';
    selected.forEach((r, idx)=>{
      const fieldId = `f_${idx}`;
      const wrap = document.createElement('div');
      wrap.className = 'card';
      wrap.style.margin = '10px 0';
      wrap.innerHTML = `
        <div class="row">
          <div class="col-12"><strong>${idx+1}.</strong> ${r.text}</div>
          <div class="col-4">
            <label>الاستجابة</label>
            ${r.kind==='yn'
              ? `<div class="center" style="gap:12px">
                    <label class="pill"><input type="radio" name="resp_${fieldId}" value="صح"> صح</label>
                    <label class="pill"><input type="radio" name="resp_${fieldId}" value="خطأ"> خطأ</label>
                 </div>`
              : `<select name="resp_${fieldId}">
                    <option value="">— اختر التقييم —</option>
                    <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
                 </select>`}
          </div>
          <div class="col-8"><label>ملاحظة (حتى 50 حرفًا)
            <input type="text" name="note_${fieldId}" maxlength="50" placeholder="ملاحظة قصيرة">
          </label></div>
        </div>`;
      els.clientForm.appendChild(wrap);
    });

    els.admin.classList.add('hidden');
    els.client.classList.remove('hidden');
    els.inspectDate.value = els.todayInput.value || todayISO;
  };

  els.exportHTML.onclick = ()=>{
    const selected = state.rows.filter(r=>r.include && r.text.trim());
    if(selected.length===0){ alert('اختر بندًا واحدًا على الأقل.'); return; }

    const safe = s=>String(s||'').replace(/[&<>]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]));
    const blocks = selected.map((r,i)=>`
      <div style="border:1px solid #ddd;border-radius:12px;padding:10px;margin:8px 0">
        <div><strong>${i+1}.</strong> ${safe(r.text)}</div>
        <div style="margin-top:6px">الاستجابة: ${r.kind==='yn'?'صح/خطأ':'تقييم 1–5'} | ملاحظة: حتى 50 حرفًا</div>
      </div>`).join('');

    const html = `<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
      <title>نسخة العميل (ساكنة)</title></head><body style="font-family:Tahoma,Arial,sans-serif;line-height:1.6">
      ${state.logoDataURL?`<div><img src="${state.logoDataURL}" style="height:60px"></div>`:''}
      <h2>نسخة العميل – قائمة التدقيق</h2>
      <div>رقم الباب ${safe(els.gateNo.value)} – ${safe(els.gateName.value)} | العميل: ${safe(els.clientName.value)} | الموقع: ${safe(els.siteName.value)}</div>
      <div>التاريخ: ${els.todayInput.value||todayISO}</div>
      <hr>
      ${blocks}
      <hr>
      <div>اسم المدقق: ____________ | توقيع: ____________ | التاريخ: ____________</div>
      </body></html>`;

    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `نسخة-العميل-${els.todayInput.value||todayISO}.html`; a.click();
    URL.revokeObjectURL(url);
  };

  function buildSummaryText(){
    const lines = [];
    lines.push(`نسخة العميل – قائمة التدقيق`);
    lines.push(`الباب ${els.gateNo.value||'-'} – ${els.gateName.value||'-'}`);
    lines.push(`العميل: ${els.clientName.value||'-'} | الموقع: ${els.siteName.value||'-'}`);
    lines.push(`تاريخ: ${els.inspectDate.value||els.todayInput.value||todayISO}`);
    lines.push('---');
    const blocks = els.clientForm.querySelectorAll('.card');
    blocks.forEach((b, i)=>{
      const text = b.querySelector('div strong').parentNode.textContent.replace(/^\\d+\\.\\s*/, '').trim();
      let resp = '';
      const radios = b.querySelectorAll(`input[name="resp_f_${i}"]`);
      if(radios.length){
        const checked = Array.from(radios).find(r=>r.checked); resp = checked? checked.value: '';
      } else {
        const sel = b.querySelector('select[name="resp_f_'+i+'"]'); resp = sel? (sel.value||''):'';
      }
      const note = (b.querySelector(`input[name="note_f_${i}"]`)||{}).value||'';
      lines.push(`${i+1}) ${text} | ${resp||'—'} ${note? ' | ملاحظة: '+note: ''}`);
    });
    lines.push('---');
    lines.push(`المدقق: ${els.auditorName.value||'-'}`);
    return lines.join('\\n');
  }

  els.printBtn.onclick = ()=> window.print();
  els.sendWA.onclick = ()=>{ const text = buildSummaryText(); const url = 'https://wa.me/?text=' + encodeURIComponent(text); window.open(url, '_blank'); };
  els.sendEmail.onclick = ()=>{
    const subject = `نسخة العميل – ${els.clientName.value||''} – ${els.gateName.value||''}`.trim();
    const body = buildSummaryText();
    const mail = `mailto:ergonomicindustrial@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = mail;
  };

  function seedIfEmpty(){
    if(state.rows.length) return;
    ['تزويد الآلات بحواجز أمان مناسبة','لوحات التحذير مثبتة في الأماكن الخطرة','تدريب العاملين على تشغيل الآلات بأمان','وجود خطة استجابة للطوارئ وإسعافات أولية','سجلات الصيانة محدثة أسبوعيًا'].forEach(t=> addRow(t));
  }

  loadDraft();
  seedIfEmpty();
  ['gateNo','gateName','todayInput','clientName','siteName','defaultResp'].forEach(id=>{
    els[id].addEventListener('input', persist);
    els[id].addEventListener('change', persist);
  });
</script>
</body>
</html>
"""

static_client = """<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>نسخة العميل – نموذج ثابت للطباعة</title>
<style>
  body{margin:0;background:#f7f8fb;color:#111;font-family:"Noto Kufi Arabic","Cairo",Tahoma,Arial,sans-serif}
  .wrap{max-width:900px;margin:auto;padding:16px}
  .card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px}
  h1{margin:.3rem 0 1rem;font-size:22px;color:#2563eb;text-align:center}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid #ddd;padding:8px;vertical-align:top}
  th{background:#eef2ff}
  .toolbar{display:flex;gap:8px;margin:10px 0}
  @media print{.no-print{display:none} body{background:#fff} .card{border:0;box-shadow:none}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>✅ نسخة العميل – نموذج ثابت للطباعة</h1>
    <div class="toolbar">
      <div style="flex:1">رقم الباب: __________</div>
      <div style="flex:2">اسم الباب: __________________________</div>
      <div style="flex:1">التاريخ: ____ / ____ / ______</div>
    </div>
    <div class="toolbar">
      <div style="flex:1">اسم العميل: ____________________</div>
      <div style="flex:1">الموقع: ____________________</div>
      <div style="flex:1">اسم المدقق: ____________________</div>
    </div>
    <table>
      <thead><tr><th style="width:40px">#</th><th>البند</th><th style="width:140px">الاستجابة</th><th style="width:200px">ملاحظة (≤50)</th></tr></thead>
      <tbody>
        <tr><td>1</td><td>تزويد الآلات بحواجز أمان مناسبة</td><td>صح ☐ خطأ ☐ / 1 2 3 4 5</td><td></td></tr>
        <tr><td>2</td><td>لوحات التحذير مثبتة في الأماكن الخطرة</td><td>صح ☐ خطأ ☐ / 1 2 3 4 5</td><td></td></tr>
        <tr><td>3</td><td>تدريب العاملين على تشغيل الآلات بأمان</td><td>صح ☐ خطأ ☐ / 1 2 3 4 5</td><td></td></tr>
        <tr><td>4</td><td>وجود خطة استجابة للطوارئ وإسعافات أولية</td><td>صح ☐ خطأ ☐ / 1 2 3 4 5</td><td></td></tr>
        <tr><td>5</td><td>سجلات الصيانة محدثة أسبوعيًا</td><td>صح ☐ خطأ ☐ / 1 2 3 4 5</td><td></td></tr>
      </tbody>
    </table>
    <div style="margin-top:14px">التوقيع: _______________________ التاريخ: ____ / ____ / ______</div>
    <div class="no-print" style="margin-top:10px"><button onclick="window.print()">🖨️ طباعة</button> <a href="mailto:ergonomicindustrial@gmail.com?subject=%D9%86%D8%B3%D8%AE%D8%A9%20%D8%A7%D9%84%D8%B9%D9%85%D9%8A%D9%84">✉️ إرسال بالبريد</a> <a href="https://wa.me/?text=%D9%86%D8%B3%D8%AE%D8%A9%20%D8%A7%D9%84%D8%B9%D9%85%D9%8A%D9%84" target="_blank">📲 واتساب</a></div>
  </div>
</div>
</body>
</html>
"""

p1 = Path("/mnt/data/نسخة-العميل-إصدار-مستقل.html")
p1.write_text(standalone_html, encoding="utf-8")

p2 = Path("/mnt/data/نسخة-العميل-نموذج-ثابت.html")
p2.write_text(static_client, encoding="utf-8")

str(p1), str(p2)
