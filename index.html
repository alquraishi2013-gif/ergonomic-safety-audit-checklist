<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¯ÙØ²Ø§ÙŠÙ†Ø± â€“ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø§Ø¨ ÙˆØªÙˆÙ„ÙŠØ¯ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (v2.7)</title>
<style>
  :root{--bg:#f7f8fb;--ink:#111;--muted:#666;--line:#e5e7eb;--card:#fff;--accent:#2563eb;--head:#e6f0ff}
  *{box-sizing:border-box}
  html, body, input, select, textarea, button, table{font-variant-numeric:lining-nums tabular-nums}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Kufi Arabic","Cairo",Tahoma,Arial,sans-serif}
  .wrap{max-width:1100px;margin:auto;padding:18px}
  .card{background:var(--card);border:1px solid #d9dde5;border-radius:14px;padding:18px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
  .title{display:flex;align-items:center;gap:12px}
  .title h1{margin:0;font-size:20px}
  .logo{height:64px;object-fit:contain}
  .muted{color:var(--muted);font-size:13px}
  .row{display:grid;gap:10px}
  @media(min-width:768px){.row{grid-template-columns:repeat(12,1fr)}.col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-5{grid-column:span 5}.col-6{grid-column:span 6}.col-8{grid-column:span 8}.col-12{grid-column:span 12}}
  input[type=text],input[type=date],input[type=search],input[type=number],select{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid #cfd7e3;padding:8px;vertical-align:middle}
  th{background:var(--head);text-align:center}
  td.num{width:54px;text-align:center}
  td[contenteditable]{outline:0;min-height:28px}
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #d0d7ff;background:#fff;cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;border:1px solid #c7d2fe;font-size:.8rem;color:#374151}
  .hidden{display:none!important}
  .box{border:1px dashed #cfd7e3;border-radius:10px;padding:10px;margin:8px 0}
  @media print{.no-print{display:none!important}.card{border:0;box-shadow:none}body{background:#fff}}
  .tests{margin-top:10px}
  .tests pre{white-space:pre-wrap;background:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;padding:10px}
  .footer{margin-top:18px;font-size:12px;color:#334155;text-align:center;border-top:1px solid #d9dde5;padding-top:10px}
  .footer a{color:#2563eb;text-decoration:none}
  .sharebar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØµÙ…Ù… -->
  <section id="designer" class="card">
    <div class="title">
      <!-- Ø´Ø¹Ø§Ø± Ø´Ø±ÙƒØªÙƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
      <img id="brandFixed" class="logo" alt="Ergonomic Industrial" src="Arkonomic Industrial Safety-0411.png" style="margin-inline-start:auto">
      <h1 data-i18n="title.designer">Ø¯ÙØ²Ø§ÙŠÙ†Ø± â€“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø§Ø¨ ÙˆØªØ­Ø¶ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</h1>
      <span style="margin-inline-start:auto"></span>
      <div class="no-print" style="display:flex;gap:8px;align-items:center">
        <label class="pill" style="display:flex;align-items:center;gap:6px" data-i18n="label.lang">Ø§Ù„Ù„ØºØ©</label>
        <select id="langSel" class="no-print" style="width:auto">
          <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="en">English</option>
        </select>
        <button type="button" class="btn" id="printSetup">ğŸ–¨ï¸ <span data-i18n="btn.printSetup">Ø·Ø¨Ø§Ø¹Ø©</span></button>
      </div>
    </div>
    <div class="muted" data-i18n="subtitle">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ø¨ ÙˆØ§Ù„Ù‚Ø§Ù„Ø¨ØŒ Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØ£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ Ø«Ù… Ù…Ø¹Ø§ÙŠÙ†Ø©/ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„. Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§.</div>
    <div id="toast" class="hidden" style="margin-top:8px;padding:8px 12px;border:1px solid #c7d2fe;background:#eef2ff;border-radius:10px;color:#374151"></div>

    <div class="row" style="margin-top:10px">
      <div class="col-4"><label><span data-i18n="field.company">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</span><br><input id="dClient" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø±ÙƒØ© Ø§Ù„Ø®Ù„ÙŠØ¬"></label></div>
      <div class="col-4"><label><span data-i18n="field.site">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</span><br><input id="dSite" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…ØµÙ†Ø¹ Ø§Ù„Ø´Ø¹ÙŠØ¨Ø©"></label></div>
      <div class="col-4"><label><span data-i18n="field.desc">ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span><br>
        <div style="display:flex;gap:6px">
          <select id="dDescSel" style="flex:1">
            <option value="">â€” Ø§Ø®ØªØ± ÙˆØµÙÙ‹Ø§ â€”</option>
            <option data-i18n="desc.office">Ù…ÙƒØªØ¨</option>
            <option data-i18n="desc.workshop">ÙˆØ±Ø´Ø©</option>
            <option data-i18n="desc.factory">Ù…ØµÙ†Ø¹</option>
            <option data-i18n="desc.warehouse">Ù…Ø³ØªÙˆØ¯Ø¹</option>
            <option data-i18n="desc.outdoor">Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ÙŠ</option>
            <option value="__other" data-i18n="desc.other">Ø£Ø®Ø±Ù‰â€¦</option>
          </select>
          <input id="dDescOther" type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙÙ‹Ø§" class="hidden" style="flex:1">
        </div>
      </label></div>
      <div class="col-3"><label><span data-i18n="field.gateNo">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø¨</span><br><input id="gateNo" type="text" placeholder="1"></label></div>
      <div class="col-5"><label><span data-i18n="field.gateName">Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨</span><br><input id="gateName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¢Ù„Ø§Øª"></label></div>
      <div class="col-4"><label><span data-i18n="field.issue">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</span><br><input id="issueDate" type="date"></label></div>
      <div class="col-6 no-print" style="display:flex;gap:8px;align-items:center">
        <label class="btn" style="display:inline-flex;align-items:center;gap:8px"><input type="file" id="brandInput" accept="image/*"> <span data-i18n="upload.brand">Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØµÙ…Ù…</span></label>
        <label class="btn" style="display:inline-flex;align-items:center;gap:8px"><input type="file" id="logoInput" accept="image/*"> <span data-i18n="upload.client">Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„</span></label>
      </div>
    </div>

    <div class="toolbar no-print">
      <span class="pill" data-i18n="label.quick">ğŸ“š Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©:</span>
      <button type="button" class="btn" data-tpl="ch1">Ø¨Ø§Ø¨ 1</button>
      <button type="button" class="btn" data-tpl="ch2">Ø¨Ø§Ø¨ 2</button>
      <button type="button" class="btn" data-tpl="ch3">Ø¨Ø§Ø¨ 3</button>
      <button type="button" class="btn" data-tpl="ch4">Ø¨Ø§Ø¨ 4</button>
      <button type="button" class="btn" data-tpl="ch5">Ø¨Ø§Ø¨ 5</button>
      <button type="button" class="btn" data-tpl="ch6">Ø¨Ø§Ø¨ 6</button>
      <button type="button" class="btn" data-tpl="ch7">Ø¨Ø§Ø¨ 7</button>
      <button type="button" class="btn" data-tpl="ch8">Ø¨Ø§Ø¨ 8</button>
      <button type="button" class="btn" data-tpl="ergo">Ergonomic</button>
      <span style="flex:1"></span>
      <label class="pill"><input type="checkbox" id="optChecks" checked> <span data-i18n="opt.yesno">âœ”/âœ– (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)</span></label>
      <label class="pill"><input type="checkbox" id="optRisk"> <span data-i18n="opt.scale">ØªÙ‚ÙŠÙŠÙ… 1â€“5 (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)</span></label>
    </div>

    <div class="toolbar no-print">
      <button type="button" class="btn" id="addRow">â• <span data-i18n="btn.add">Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</span></button>
      <button type="button" class="btn" id="selectAll">âœ”ï¸ <span data-i18n="btn.all">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</span></button>
      <button type="button" class="btn" id="clearAll">âŒ <span data-i18n="btn.none">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</span></button>
      <button type="button" class="btn" id="deleteExcluded">ğŸ—‘ï¸ <span data-i18n="btn.delExcluded">Ø­Ø°Ù Ø§Ù„Ø¨Ù†ÙˆØ¯ ØºÙŠØ± Ø§Ù„Ù…ÙØ¶Ù…Ù‘Ù†Ø©</span></button>
      <button type="button" class="btn" id="saveDraft">ğŸ’¾ <span data-i18n="btn.save">Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</span></button>
      <button type="button" class="btn" id="reset"><span data-i18n="btn.reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span></button>
      <span style="flex:1"></span>
      <input id="filter" type="search" placeholder="ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯â€¦" style="max-width:280px" data-i18n-ph="ph.filter">
    </div>

    <table>
      <thead><tr>
        <th style="width:74px" data-i18n="th.include">ØªØ¶Ù…ÙŠÙ†</th>
        <th data-i18n="th.item">Ù†Øµ Ø§Ù„Ø¨Ù†Ø¯</th>
        <th style="width:160px" data-i18n="th.type">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
      </tr></thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="toolbar no-print">
      <button type="button" class="btn primary" id="preview">ğŸ‘ï¸ <span data-i18n="btn.preview">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªØ¨Ø§Ø±)</span></button>
      <button type="button" class="btn" id="exportHtml">â¬‡ï¸ <span data-i18n="btn.export">ØªØµØ¯ÙŠØ± HTML Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)</span></button>
      <button type="button" class="btn" id="makeLink">ğŸŒ <span data-i18n="btn.link">Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù„Ù„Ø¹Ù…ÙŠÙ„</span></button>
    </div>
    <div class="footer no-print">
      Ergonomic Industrial â€” <a href="https://ergonomicindustrial.com" target="_blank">ergonomicindustrial.com</a> â€” Email: <a href="mailto:ergonomicindustrial@gmail.com">ergonomicindustrial@gmail.com</a> â€” Phone/WhatsApp: 67756743
    </div>

    <details class="tests no-print">
      <summary>âœ… Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©</summary>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:6px 0">
        <button type="button" class="btn" id="btnRunTests">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
        <span class="pill">Ù„Ù† Ù†Ø¹Ø¯Ù‘Ù„ Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯Ø› Ø³Ù†Ø¶ÙŠÙ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙÙ‚Ø·</span>
      </div>
      <pre id="testOut" class="muted"></pre>
    </details>
  </section>

  <!-- Ù…Ø¹Ø§ÙŠÙ†Ø©/Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
  <section id="client" class="card hidden">
    <div class="title" style="justify-content:center; position:relative">
      <img id="brandTop" alt="Ergonomic Industrial" src="Arkonomic Industrial Safety-0411.png" style="height:48px;position:absolute;inset-inline-end:0;top:0">
      <div style="flex:1;display:flex;justify-content:center;gap:8px;align-items:center">
        <img id="lg2" class="logo" alt="logo" hidden>
        <h1 id="titleTxt" style="margin:0">Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â€“ Ø§Ù„Ø¨Ø§Ø¨</h1>
      </div>
    </div>

    <div class="row">
      <div class="col-4"><label data-i18n="field.company">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label><br><input id="cClient" type="text"></div>
      <div class="col-4"><label data-i18n="field.site">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><br><input id="cSite" type="text"></div>
      <div class="col-4"><label data-i18n="field.desc">ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><br><input id="cDesc" type="text" placeholder="Ù…ÙƒØªØ¨ / ÙˆØ±Ø´Ø© / â€¦" data-i18n-ph="ph.desc"></div>
      <div class="col-4"><label data-i18n="field.auditor">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ù‚Ù‚</label><br><input id="cAuditor" type="text"></div>
      <div class="col-4"><label data-i18n="field.date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><br><input id="cDate" type="date"></div>
    </div>

    <table id="clientTable">
      <thead>
        <tr>
          <th data-i18n="th.no">Ù…</th><th data-i18n="th.item">Ø§Ù„Ø¨Ù†Ø¯</th><th data-i18n="th.type">Ù†ÙˆØ¹</th><th colspan="2" data-i18n="th.field">Ø­Ù‚Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th data-i18n="th.note">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (â‰¤50)</th>
        </tr>
      </thead>
      <tbody id="clientBody"></tbody>
    </table>

    <div class="toolbar no-print sharebar">
      <button type="button" class="btn" id="back">â†©ï¸ <span data-i18n="btn.back">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</span></button>
      <span style="flex:1"></span>
      <button type="button" class="btn" id="sendWA">ğŸ“¤ <span data-i18n="btn.wa">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</span></button>
      <button type="button" class="btn" id="sendMail">ğŸ“§ <span data-i18n="btn.mail">Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„</span></button>
      <button type="button" class="btn" id="printClient">ğŸ–¨ï¸ <span data-i18n="btn.print">Ø·Ø¨Ø§Ø¹Ø© / PDF</span></button>
    </div>
  </section>
</div>

<script>
(function(){
  const $ = s=>document.querySelector(s);
  const S = s=>document.querySelectorAll(s);

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (Ù‚Ø§Ù„Ø¨ ÙÙ‚Ø· â€“ Ø§Ù„Ø±ÙØ¹ ÙŠØ¯ÙˆÙŠ)
  const LINK_BASE = "https://alquraishi2013-gif.github.io/ergonomic-safety-audit-checklist";
  const LINK_SUBDIR = "exports";

  // i18n â€” Ø¹Ø¨Ø§Ø±Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø· (ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙˆØ³Ø¹ Ù„Ø§Ø­Ù‚Ù‹Ø§)
  const i18n = {
    ar:{
      dir:'rtl', lang:'ar',
      'title.designer':'Ø¯ÙØ²Ø§ÙŠÙ†Ø± â€“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø§Ø¨ ÙˆØªØ­Ø¶ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„',
      'subtitle':'Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ø¨ ÙˆØ§Ù„Ù‚Ø§Ù„Ø¨ØŒ Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØ£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ Ø«Ù… Ù…Ø¹Ø§ÙŠÙ†Ø©/ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„. Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§.',
      'label.lang':'Ø§Ù„Ù„ØºØ©',
      'field.company':'Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©','field.site':'Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹','field.desc':'ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹','field.gateNo':'Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø¨','field.gateName':'Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨','field.issue':'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±','field.auditor':'Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ù‚Ù‚','field.date':'Ø§Ù„ØªØ§Ø±ÙŠØ®',
      'desc.office':'Ù…ÙƒØªØ¨','desc.workshop':'ÙˆØ±Ø´Ø©','desc.factory':'Ù…ØµÙ†Ø¹','desc.warehouse':'Ù…Ø³ØªÙˆØ¯Ø¹','desc.outdoor':'Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ÙŠ','desc.other':'Ø£Ø®Ø±Ù‰â€¦',
      'upload.brand':'Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØµÙ…Ù…','upload.client':'Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„',
      'label.quick':'Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©:',
      'opt.yesno':'âœ”/âœ– (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)','opt.scale':'ØªÙ‚ÙŠÙŠÙ… 1â€“5 (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)',
      'btn.printSetup':'Ø·Ø¨Ø§Ø¹Ø©','btn.add':'Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯','btn.all':'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„','btn.none':'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯','btn.delExcluded':'Ø­Ø°Ù Ø§Ù„Ø¨Ù†ÙˆØ¯ ØºÙŠØ± Ø§Ù„Ù…ÙØ¶Ù…Ù‘Ù†Ø©','btn.save':'Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©','btn.reset':'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†','btn.preview':'Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªØ¨Ø§Ø±)','btn.export':'ØªØµØ¯ÙŠØ± HTML Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)','btn.link':'Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù„Ù„Ø¹Ù…ÙŠÙ„','btn.back':'Ø±Ø¬ÙˆØ¹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„','btn.wa':'Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨','btn.mail':'Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„','btn.print':'Ø·Ø¨Ø§Ø¹Ø© / PDF',
      'th.include':'ØªØ¶Ù…ÙŠÙ†','th.item':'Ù†Øµ Ø§Ù„Ø¨Ù†Ø¯','th.type':'Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…','th.field':'Ø­Ù‚Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…','th.note':'Ù…Ù„Ø§Ø­Ø¸Ø§Øª (â‰¤50)','th.no':'Ù…',
      'ph.filter':'ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯â€¦','ph.desc':'Ù…ÙƒØªØ¨ / ÙˆØ±Ø´Ø© / â€¦',
      clientTitle:(no,name)=>`Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â€“ Ø§Ù„Ø¨Ø§Ø¨ ${no||'-'} â€“ ${name||''}`,
      type:{yesno:'âœ”/âœ–',scale:'1â€“5',note:'Ù…Ù„Ø§Ø­Ø¸Ø©'}
    },
    en:{
      dir:'ltr', lang:'en',
      'title.designer':'Designer â€“ Gate Setup & Client Copy',
      'subtitle':'Enter client and site data, choose the gate/template, edit items & rating types, then preview/export the client copy. Numbers are always LTR.',
      'label.lang':'Language',
      'field.company':'Company','field.site':'Site','field.desc':'Site description','field.gateNo':'Gate No.','field.gateName':'Gate Name','field.issue':'Issue date','field.auditor':'Auditor','field.date':'Date',
      'desc.office':'Office','desc.workshop':'Workshop','desc.factory':'Factory','desc.warehouse':'Warehouse','desc.outdoor':'Outdoor','desc.other':'Otherâ€¦',
      'upload.brand':'Upload Designer Logo','upload.client':'Upload Client Logo',
      'label.quick':'Quick gate templates:',
      'opt.yesno':'âœ”/âœ– (default for new items)','opt.scale':'Scale 1â€“5 (default for new items)',
      'btn.printSetup':'Print','btn.add':'Add item','btn.all':'Select all','btn.none':'Clear selection','btn.delExcluded':'Delete excluded items','btn.save':'Save draft','btn.reset':'Reset','btn.preview':'Preview client copy (test)','btn.export':'Export client HTML (offline)','btn.link':'Create client link','btn.back':'Back to edit','btn.wa':'Send WhatsApp','btn.mail':'Send Email','btn.print':'Print / PDF',
      'th.include':'Include','th.item':'Item text','th.type':'Rating type','th.field':'Evaluation field','th.note':'Notes (â‰¤50)','th.no':'#',
      'ph.filter':'Filter itemsâ€¦','ph.desc':'Office / Workshop / â€¦',
      clientTitle:(no,name)=>`Safety Audit â€“ Gate ${no||'-'} â€“ ${name||''}`,
      type:{yesno:'âœ”/âœ–',scale:'1â€“5',note:'Note only'}
    }
  };

  // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ AR/EN
  const templatesAR = {
    ch1:["Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ù„ÙŠÙ„ Ø¥Ø±Ø´Ø§Ø¯ÙŠ Ù„Ù„Ø³Ù„Ø§Ù…Ø© Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆÙ„ØºØ© ÙŠÙÙ‡Ù…Ù‡Ø§ Ø§Ù„Ø¹Ù…Ø§Ù„","ØªØ­Ø¯ÙŠØ¯ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù…Ù„ Ø­Ø³Ø¨ Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù†Ø´Ø§Ø·","ØªØ²ÙˆÙŠØ¯ Ø§Ù„Ù‡ÙŠØ¦Ø© Ø¨Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©","Ø¥Ø¨Ù„Ø§Øº ÙˆØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù‚Ø¨Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ø¹Ù…Ù„","ØªÙˆÙÙŠØ± Ù…Ø¹Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø¬Ø§Ù†Ù‹Ø§ ÙˆØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§","Ø§Ø¹ØªÙ…Ø§Ø¯ Ù„Ø§Ø¦Ø­Ø© Ø¬Ø²Ø§Ø¡Ø§Øª Ø®Ø§ØµØ© Ø¨Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©","ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø§Øª Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© ÙˆØªØ­Ø°ÙŠØ±ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ù„ØµÙ‚Ø§Øª Ø¨Ù„ØºØ© ÙŠÙÙ‡Ù…Ù‡Ø§ Ø§Ù„Ø¹Ù…Ø§Ù„","ØªØ¹ÙŠÙŠÙ† Ù…Ø´Ø±Ù/Ù…Ø±Ø§Ù‚Ø¨ Ø³Ù„Ø§Ù…Ø© Ø­Ø³Ø¨ Ø­Ø¬Ù… ÙˆØ®Ø·ÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´Ø£Ø©","ØªØ£Ù‡ÙŠÙ„ Ù…Ø´Ø±Ù Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø¨Ø´Ù‡Ø§Ø¯Ø© ÙˆØ®Ø¨Ø±Ø© Ù…Ù†Ø§Ø³Ø¨Ø©","Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (300+ Ø¹Ø§Ù…Ù„): Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø³Ù„Ø§Ù…Ø© ÙˆØµØ­Ø© Ù…Ù‡Ù†ÙŠØ©","ØªØ¯Ø±ÙŠØ¨ Ø¯ÙˆØ±ÙŠ Ù„Ù…Ø´Ø±ÙÙŠ ÙˆÙ…Ø±Ø§Ù‚Ø¨ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø©","Ø¥Ø¬Ø±Ø§Ø¡ ØªÙØªÙŠØ´ Ø¯ÙˆØ±ÙŠ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« ÙˆØ§Ù„Ø¥ØµØ§Ø¨Ø§Øª","Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù‡ÙŠØ¦Ø© Ø¨Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø¬Ø³ÙŠÙ…Ø© Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©","Ø­ÙØ¸ Ø³Ø¬Ù„Ø§Øª Ù…Ø­Ø¯Ø«Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…ÙØªØ´ÙŠÙ†"],
    ch2:["Ù…ØªØ§Ù†Ø© Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØ§Ù„Ø£Ø³Ù‚Ù","ØªØ¬Ù‡ÙŠØ² Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù…Ø¸Ù„Ø§Øª/Ø£Ø³Ù‚Ù","Ù…Ù…Ø±Ø§Øª ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø®Ø§Ø±Ø¬ Ø·ÙˆØ§Ø±Ø¦ Ø¢Ù…Ù†Ø©","Ø£Ø±Ø¶ÙŠØ§Øª Ø³Ù„ÙŠÙ…Ø© ÙˆÙ†Ø¸ÙŠÙØ© ÙˆØµØ±Ù Ù…ØºØ·Ù‰","Ø§Ù„ØªØ®Ù„Øµ Ø§Ù„Ø³Ù„ÙŠÙ… Ù…Ù† Ø§Ù„ÙØ¶Ù„Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©","ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚","ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø³Ù‚ÙˆØ· ÙˆØ§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø© ÙˆØ§Ù„Ø­ÙØ±","Ø³Ù„Ø§Ù„Ù… Ù…ØªÙŠÙ†Ø© ØºÙŠØ± Ø²Ù„Ù‚Ø© ÙˆÙ…Ø²ÙˆØ¯Ø© Ø¨Ø­ÙˆØ§Ø¬Ø²","Ø³Ù‚Ø§Ù„Ø§Øª Ø¢Ù…Ù†Ø© Ù…Ø¹ Ø­ÙˆØ§Ø¬Ø² ÙˆØªØ«Ø¨ÙŠØª Ø¬ÙŠØ¯","Ø³Ù†Ø¯Ø±Ø§Øª/Ù…Ù†ØµØ§Øª Ù…Ø±Ø®ØµØ© ÙˆØ¢Ù…Ù†Ø©","Ø¹Ø²Ù„ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØºØ¨Ø§Ø±/Ø§Ù„ØºØ§Ø²Ø§Øª Ù…Ø¹ Ø´ÙØ·","ÙØ­Øµ Ø£ÙˆØ¹ÙŠØ© Ø§Ù„Ø¶ØºØ·","Ø£Ø¯ÙˆØ§Øª ØµØ§Ù„Ø­Ø© ÙˆÙ…Ø­Ø¯Ø¯Ø© Ø£Ù…Ø§ÙƒÙ†Ù‡Ø§","Ù…Ø¹Ø¯Ø§Øª Ø¥Ø·ÙØ§Ø¡ Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆÙ…ÙˆØ²Ø¹Ø©"],
    ch3:["ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø¹Ù„Ù‰ ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø¢Ù„Ø§Øª","Ù„Ø§ ØªØ´ØºÙŠÙ„ Ø¯ÙˆÙ† Ø­ÙˆØ§Ø¬Ø²","Ø¹Ø¯Ù… ØªØ¹Ø·ÙŠÙ„ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙˆÙ‚Ø§ÙŠØ©","Ù…Ø³Ø§ÙØ© 60 Ø³Ù… Ø­ÙˆÙ„ Ø§Ù„Ø¢Ù„Ø§Øª","Ø­ÙˆØ§Ø¬Ø² Ø¯Ø§Ø¦Ù…Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø®Ø·Ø±Ø©","Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­ÙˆØ§Ø¬Ø² ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù","Ù…ÙØªØ§Ø­ Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦","ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ© Ø¨Ø³Ø¬Ù„Ø§Øª","ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ø±Ø± ÙˆØ§Ù„Ø´Ø¸Ø§ÙŠØ§"],
    ch4:["ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø®Ø§Ù…Ø§Øª Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø© Ù„Ø§ ØªØ´ÙƒÙ„ Ø®Ø·Ø±Ø§Ù‹ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†","Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØµÙŠØ§Ù†ØªÙ‡Ø§ Ø¯ÙˆØ±ÙŠØ§Ù‹ (ØªÙØªÙŠØ´ Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙˆØ§Ø®ØªØ¨Ø§Ø± Ø³Ù†ÙˆÙŠ)","ØªØ«Ø¨ÙŠØª Ù„ÙˆØ­Ø© ØªØ¨ÙŠÙ† Ø£Ù‚ØµÙ‰ Ø­Ù…ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ù…Ø£Ù…ÙˆÙ†Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ø¢Ù„Ø© Ø±ÙØ¹","Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø¬Ù„ Ø®Ø§Øµ Ù„ÙƒÙ„ Ø¢Ù„Ø© Ø±ÙØ¹ ÙŠØ´Ù…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ø¹ØŒ Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø£Ù‚ØµÙ‰ØŒ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠØŒ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª","ØªØ²ÙˆÙŠØ¯ Ù…Ø´ØºÙ‘Ù„ Ø¢Ù„Ø© Ø§Ù„Ø±ÙØ¹ Ø¨ÙˆØ³ÙŠÙ„Ø© Ø§ØªØµØ§Ù„ ØµØ§Ù„Ø­Ø© Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„","ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø±Ø§Øª Ø¢Ù„Ø§Øª Ø§Ù„Ø±ÙØ¹ Ø¨ÙˆØ³Ø§Ø¦Ù„ ØªØ­Ø°ÙŠØ± ÙˆÙ…Ù†Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø£Ùˆ ÙˆÙ‚ÙˆÙÙ‡Ù… ØªØ­Øª Ø§Ù„Ø£Ø­Ù…Ø§Ù„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©","ØªØ´ØºÙŠÙ„ Ø¢Ù„Ø§Øª Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ø¬Ø± ÙˆØ§Ù„Ù†Ù‚Ù„ ÙŠÙ‚ØªØµØ± Ø¹Ù„Ù‰ Ø£Ø´Ø®Ø§Øµ Ù…Ø®ØªØµÙŠÙ† ÙˆÙ…Ø¤Ù‡Ù„ÙŠÙ† ÙˆÙ…Ø±Ø®Ù‘ØµÙŠÙ†","ØªØ£Ù…ÙŠÙ† ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ© ÙˆØ¥Ø¬Ø±Ø§Ø¡ ÙØ­Øµ Ø¯ÙˆØ±ÙŠ Ù„Ù‡Ø§ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©","ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆÙÙ‚ Ø£ØµÙˆÙ„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø³Ù„ÙŠÙ…ØŒ Ù…Ø¹ Ø¹Ø²Ù„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø·Ø±Ø© ÙÙŠ Ù…Ø®Ø§Ø²Ù† Ø®Ø§ØµØ©","ÙˆØ¶Ø¹ Ù„Ø§ÙØªØ§Øª Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø§Ø²Ù† ØªØ¨ÙŠÙ† Ø¯Ø±Ø¬Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© ÙˆØ·Ø±Ù‚ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¢Ù…Ù†"],
    ch5:["Ù…ÙØ§ØªÙŠØ­ Ø¹Ø²Ù„ Ø¢Ù…Ù†Ø© ÙˆØ¨Ø£Ù…Ø§ÙƒÙ† Ø¸Ø§Ù‡Ø±Ø©","Ù‚ÙˆØ§Ø·Ø¹ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠØ© Ù„Ù„Ø£Ø¹Ø·Ø§Ù„","Ù„ÙˆØ­Ø§Øª ØªÙˆØ²ÙŠØ¹ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ø¢Ù…Ù†Ø©","Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù„ÙˆØ­Ø§Øª Ù„Ù„ØªØ®Ø²ÙŠÙ†","Ø¹Ø²Ù„ ÙƒØ§Ù…Ù„ Ù„Ù„Ø£Ø³Ù„Ø§Ùƒ ÙˆØ§Ù„ÙƒØ§Ø¨Ù„Ø§Øª","ÙØ­Øµ Ø¯ÙˆØ±ÙŠ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© ÙÙˆØ±ÙŠØ©","Ø¹Ø§Ù…Ù„ÙˆÙ† Ù…Ø¤Ù‡Ù„ÙˆÙ†","Ø¹Ø²Ù„ Ø§Ù„ØªÙŠØ§Ø± Ù‚Ø¨Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØªØ­Ø°ÙŠØ±Ø§Øª","Ù‚ÙØ§Ø²Ø§Øª/Ø£Ø­Ø°ÙŠØ© Ø¹Ø§Ø²Ù„Ø© ÙˆÙ…Ù†Ø¹ Ø§Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª","ØªØ£Ø±ÙŠØ¶ Ø§Ù„Ø³ØªØ§ØªÙŠÙƒ","Ù…Ø¹Ø¯Ø§Øª Ø¥Ø·ÙØ§Ø¡ Ø­Ø±Ø§Ø¦Ù‚ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©","ÙØ­ÙˆØµ Ø·Ø¨ÙŠØ© Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡","Ù„ÙˆØ­Ø§Øª ØªØ­Ø°ÙŠØ± ÙˆØ§Ø¶Ø­Ø©"],
    ch6:["Ø¥Ø¶Ø§Ø¡Ø© ÙƒØ§ÙÙŠØ© ÙˆÙ…ØªØ¬Ø§Ù†Ø³Ø©","Ø§Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡/Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²Ø§Øª","Ø­Ø±Ø§Ø±Ø© Ø¹Ù…Ù„ Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯","ÙˆÙ‚Ø§ÙŠØ© Ù„Ù„Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©","ØªÙ‡ÙˆÙŠØ© ÙƒØ§ÙÙŠØ©","Ø­ÙˆØ§Ø¬Ø² Ø­Ø±Ø§Ø±ÙŠØ© Ù„Ù„Ø£ÙØ±Ø§Ù† ÙˆØ§Ù„Ù„Ø­Ø§Ù…"],
    ch7:["Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©","Ø´ÙØ·/ØªÙ‡ÙˆÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ù…ØµØ¯Ø±","Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¨Ø¨Ø¯Ø§Ø¦Ù„ Ø£Ù‚Ù„ Ø®Ø·Ø±Ø§Ù‹","ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…ÙØªØ´ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯","ØªÙ†Ø¸ÙŠÙ Ø±Ø·Ø¨/Ø´ÙØ· Ø¯ÙˆØ±ÙŠ"],
    ch8:["Ø£Ù…Ø§ÙƒÙ† Ø±Ø§Ø­Ø©/Ø·Ø¹Ø§Ù… ÙˆÙÙ‚ Ø§Ø´ØªØ±Ø§Ø·Ø§Øª","ØºØ±Ù ØªØ¨Ø¯ÙŠÙ„ ÙˆØ®Ø²Ø§Ø¦Ù†","Ø­Ù…Ø§Ù…Ø§Øª ÙˆÙ…ÙˆØ§Ø¯ ØªÙ†Ø¸ÙŠÙ","Ù…ÙŠØ§Ù‡ Ø´Ø±Ø¨ Ù…Ø¨Ø±Ø¯Ø© ÙƒØ§ÙÙŠØ©","Ø¹Ø¯Ø¯ ÙƒØ§ÙÙ Ù…Ù† Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙŠØ§Ù‡","ØµØ±Ù ØµØ­ÙŠ Ù…Ù„Ø§Ø¦Ù… Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù†Ø§Ø¦ÙŠØ©"],
    ergo:["Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…Ù†Ø§Ø³Ø¨","ÙƒØ±Ø³ÙŠ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø¯Ø¹Ù… Ø£Ø³ÙÙ„ Ø§Ù„Ø¸Ù‡Ø±","Ù…Ø³Ø§ÙØ© Ø±Ø¤ÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø© Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§","Ù…Ù†Ø§ÙˆÙ„Ø© ÙŠØ¯ÙˆÙŠØ© Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯"]
  };
  const templatesEN = {
    ch1:["Provide a written safety manual in Arabic and a language workers understand","Identify work hazards according to activity","Submit approved final drawings to the Authority","Inform and train workers on hazards and prevention before work starts","Provide PPE free of charge and train workers on use","Adopt a sanctions schedule for safety violations","Post clear safety/warning signs in a language workers understand","Appoint a Safety Supervisor/Officer by size/risk","Qualify the Safety Supervisor with proper certificate/experience","High-risk sites (300+ workers): establish OHS department","Periodic training for safety staff","Conduct periodic inspections and record incidents","Notify the Authority of major accidents within 24h","Maintain updated records available to inspectors"],
    ch2:["Sound buildings and roofs","Shaded/roofed work yards","Clear passages and safe exits","Good flooring, clean, covered drains","Proper disposal of waste and chemicals","Periodic maintenance of buildings/facilities","Protection from falls/falling objects/holes","Non-slip sturdy ladders with guardrails","Safe scaffolds with proper guardrails/anchorage","Licensed safe mezzanines/platforms","Enclose dust/gas sources with extraction","Inspect pressure vessels","Serviceable tools with assigned storage","Adequate fire-fighting equipment"] ,
    ch3:["Train workers on machine guarding","No operation without guards","Do not bypass safety devices","60 cm clearance around machines","Fixed guards for hazardous parts","Remove guards only after shutdown","Emergency stop switch","Periodic maintenance with records","Protection from sparks/projectiles"],
    ch4:["Safe handling of materials without endangering workers","Use proper lifting equipment; weekly inspection & annual test","Display SWL plate on each lifting machine","Keep logbook per lifting machine (data, SWL, inspections, maintenance)","Provide operator with working communication device","Define lifting routes with warnings; no standing under loads","Operate lifting/winching/transport by qualified licensed persons","Secure vehicles; periodic inspection per safety requirements","Store materials properly; segregate hazardous substances","Post storage signage with hazard class and handling rules"],
    ch5:["Safe isolation switches in visible locations","Automatic breakers for faults","Distribution boards in safe accessible places","No storage inside distribution boards","Fully insulated cables rated for voltage","Periodic inspection and immediate repair","Qualified personnel only","Isolate power before maintenance; warnings posted","Insulating gloves/boots; no jewelry","Static grounding","Electrical fire-fighting equipment","Medical checks for electrical workers","Clear warning signs"],
    ch6:["Adequate uniform lighting","Limit noise/vibration","Working temperature within limits","Protect outdoor workers","Adequate ventilation","Heat shields for furnaces/welding"],
    ch7:["Exposure limits for chemicals","Source extraction/ventilation","Substitute with less hazardous alternatives","Provide inspectors material data","Wet cleaning/regular vacuuming"],
    ch8:["Rest/meal rooms per requirements","Changing rooms & lockers","Washrooms & cleansing materials","Adequate cooled drinking water","Sufficient toilets","Proper sanitation for remote sites"],
    ergo:["Proper desk height","Adjustable chair with lumbar support","Recommended screen viewing distance","Manual handling within limits"]
  };

  // Ø®Ø±Ø§Ø¦Ø· Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨
  const gateNameMapAR = { ch1:'Ø§Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©', ch2:'Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚', ch3:'Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¢Ù„Ø§Øª', ch4:'ØªØ¯Ø§ÙˆÙ„ ÙˆØ±ÙØ¹ ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø¯', ch5:'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©', ch6:'Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„', ch7:'Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©', ch8:'Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ø¹Ø§Ù…Ø©', ergo:'Ergonomic' };
  const gateNameMapEN = { ch1:'General Provisions', ch2:'Buildings & Facilities', ch3:'Machine Guarding', ch4:'Materials Handling/Lifting/Storage', ch5:'Electrical Safety', ch6:'Work Environment', ch7:'Chemicals', ch8:'Amenities', ergo:'Ergonomic' };
  const gateNoMap = { ch1:'1', ch2:'2', ch3:'3', ch4:'4', ch5:'5', ch6:'6', ch7:'7', ch8:'8' };
  const numToGateKey = { '1':'ch1','2':'ch2','3':'ch3','4':'ch4','5':'ch5','6':'ch6','7':'ch7','8':'ch8' };

  // Ø¹Ù†Ø§ØµØ±
  const els = {
    designer: $('#designer'), client: $('#client'),
    brandFixed: $('#brandFixed'), brandTop: $('#brandTop'), brandInput: $('#brandInput'), logoInput: $('#logoInput'),
    lg: $('#lg2'), langSel: $('#langSel'),
    dClient: $('#dClient'), dSite: $('#dSite'), dDescSel: $('#dDescSel'), dDescOther: $('#dDescOther'),
    gateNo: $('#gateNo'), gateName: $('#gateName'), issueDate: $('#issueDate'),
    optChecks: $('#optChecks'), optRisk: $('#optRisk'),
    addRow: $('#addRow'), selectAll: $('#selectAll'), clearAll: $('#clearAll'), deleteExcluded: $('#deleteExcluded'), saveDraft: $('#saveDraft'), reset: $('#reset'),
    filter: $('#filter'), tbody: $('#tbody'),
    preview: $('#preview'), exportHtml: $('#exportHtml'), makeLink: $('#makeLink'), printSetup: $('#printSetup'),
    titleTxt: $('#titleTxt'), cClient: $('#cClient'), cSite: $('#cSite'), cDesc: $('#cDesc'), cAuditor: $('#cAuditor'), cDate: $('#cDate'),
    clientBody: $('#clientBody'), back: $('#back'), printClient: $('#printClient'),
    btnRunTests: $('#btnRunTests'), testOut: $('#testOut'),
    sendWA: $('#sendWA'), sendMail: $('#sendMail')
  };

  // ØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ
  const today = new Date().toISOString().slice(0,10);
  els.issueDate.value = today; els.cDate.value = today;

  // Ø§Ù„Ø­Ø§Ù„Ø©
  let clientLogoData = '';
  let brandLogoData = '';
  let rows = []; // {id,text,include,type}
  let lang = 'ar';

  // Ø§Ù„ØªØ®Ø²ÙŠÙ†
  const LS_KEY = 'designer_console_v2_7_types';

  function uid(){return Math.random().toString(36).slice(2)}
  function escapeHtml(s){ return String(s).replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])) }
  function toast(msg){ const t=document.getElementById('toast'); if(!t) return; t.textContent=msg; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'),1800) }

  // i18n helpers
  function applyI18n(){
    const dict = i18n[lang];
    document.documentElement.setAttribute('lang', dict.lang);
    document.documentElement.setAttribute('dir', dict.dir);
    S('[data-i18n]').forEach(el=>{ const k=el.getAttribute('data-i18n'); if(dict[k]) el.textContent = dict[k]; });
    S('[data-i18n-ph]').forEach(el=>{ const k=el.getAttribute('data-i18n-ph'); if(dict[k]) el.setAttribute('placeholder', dict[k]); });
    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¸Ø§Ù‡Ø±Ù‹Ø§
    if(!els.client.classList.contains('hidden')){
      els.titleTxt.textContent = dict.clientTitle(els.gateNo.value, els.gateName.value);
    }
  }

  // Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹
  function persist(){
    const payload = {
      clientLogoData, brandLogoData, rows, lang,
      dClient: els.dClient.value, dSite: els.dSite.value,
      descSel: els.dDescSel.value, descOther: els.dDescOther.value,
      gateNo: els.gateNo.value, gateName: els.gateName.value, issue: els.issueDate.value,
      opts: { checks: els.optChecks.checked, risk: els.optRisk.checked }
    };
    try{ localStorage.setItem(LS_KEY, JSON.stringify(payload)) }catch(e){ console.warn('persist failed', e) }
  }
  function restore(){
    const raw = localStorage.getItem(LS_KEY); if(!raw) return;
    try{
      const d = JSON.parse(raw);
      clientLogoData = d.clientLogoData||''; brandLogoData = d.brandLogoData||'';
      rows = Array.isArray(d.rows)? d.rows.map(x=>({id:x.id,text:x.text,include:!!x.include,type:x.type||'yesno'})) : [];
      els.dClient.value = d.dClient||''; els.dSite.value=d.dSite||'';
      els.dDescSel.value = d.descSel||''; els.dDescOther.value = d.descOther||'';
      if(els.dDescSel.value==='__other'){ els.dDescOther.classList.remove('hidden') }
      els.gateNo.value=d.gateNo||''; els.gateName.value=d.gateName||''; els.issueDate.value=d.issue||today;
      if(d.opts){ els.optChecks.checked=!!d.opts.checks; els.optRisk.checked=!!d.opts.risk }
      lang = d.lang||'ar'; els.langSel.value = lang;
      renderSetup(); applyI18n();
      // Ø¹Ø±Ø¶ Ø´Ø¹Ø§Ø±ÙŠÙ’Ù† Ø¥Ù† ÙˆÙØ¬Ø¯Ø§
      if(brandLogoData){ els.brandFixed.src = brandLogoData; els.brandTop.src = brandLogoData; }
    }catch(e){ console.warn('restore failed', e) }
  }

  // Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±ÙŠÙ†
  els.logoInput.addEventListener('change', e=>{
    const f=e.target.files[0]; if(!f){clientLogoData=''; persist(); return}
    const rd=new FileReader(); rd.onload=ev=>{ clientLogoData=ev.target.result; persist(); toast(lang==='ar'? 'ØªÙ… Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ù†Ø³Ø®Ø©)':'Client logo uploaded (will appear at bottom)') }; rd.readAsDataURL(f)
  })
  els.brandInput.addEventListener('change', e=>{
    const f=e.target.files[0]; if(!f){brandLogoData=''; persist(); return}
    const rd=new FileReader(); rd.onload=ev=>{ brandLogoData=ev.target.result; els.brandFixed.src = brandLogoData; els.brandTop.src = brandLogoData; persist(); toast(lang==='ar'? 'ØªÙ… Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØµÙ…Ù…':'Designer logo uploaded') }; rd.readAsDataURL(f)
  })

  // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯
  function defaultType(){
    if(els.optRisk.checked && !els.optChecks.checked) return 'scale';
    if(!els.optRisk.checked && !els.optChecks.checked) return 'note';
    return 'yesno';
  }
  function addRow(text){ rows.push({id:uid(), text:(text|| (lang==='ar'? '* Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯':'* New Item')), include:true, type: defaultType()}); renderSetup(); persist() }

  function renderSetup(){
    const q = (els.filter.value||'').trim().toLowerCase();
    els.tbody.innerHTML='';
    rows.forEach(r=>{
      if(q && !String(r.text||'').toLowerCase().includes(q)) return;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td style="width:74px;text-align:center"><input type="checkbox" class="pick" data-id="${r.id}" ${r.include?'checked':''}></td>
                    <td contenteditable class="txt" data-id="${r.id}">${escapeHtml(r.text||'')}</td>
                    <td style="text-align:center">
                      <select class="typeSel" data-id="${r.id}">
                        <option value="yesno" ${r.type==='yesno'? 'selected':''}>${i18n[lang].type.yesno}</option>
                        <option value="scale" ${r.type==='scale'? 'selected':''}>${i18n[lang].type.scale}</option>
                        <option value="note" ${r.type==='note'? 'selected':''}>${i18n[lang].type.note}</option>
                      </select>
                    </td>`;
      els.tbody.appendChild(tr);
    })
  }

  // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø¯ÙˆÙ„
  els.addRow.onclick=()=>addRow();
  els.selectAll.onclick=()=>{ rows.forEach(r=>r.include=true); renderSetup(); persist() };
  els.clearAll.onclick=()=>{ rows.forEach(r=>r.include=false); renderSetup(); persist() };
  els.deleteExcluded.onclick=()=>{ if(confirm(lang==='ar'? 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ ØºÙŠØ± Ø§Ù„Ù…ÙØ¶Ù…Ù‘Ù†Ø©. Ù…ØªØ§Ø¨Ø¹Ø©ØŸ':'Delete all excluded items?')){ rows = rows.filter(r=>r.include); renderSetup(); persist(); toast(lang==='ar'? 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ù†ÙˆØ¯ ØºÙŠØ± Ø§Ù„Ù…ÙØ¶Ù…Ù‘Ù†Ø©':'Excluded items deleted') } };
  els.tbody.addEventListener('input', e=>{ if(e.target.classList.contains('txt')){ const id=e.target.dataset.id; const r=rows.find(x=>x.id===id); if(r){ r.text=e.target.innerText.trim(); persist() } } })
  els.tbody.addEventListener('change', e=>{
    if(e.target.classList.contains('pick')){ const id=e.target.dataset.id; const r=rows.find(x=>x.id===id); if(r){ r.include=e.target.checked; persist() } }
    if(e.target.classList.contains('typeSel')){ const id=e.target.dataset.id; const r=rows.find(x=>x.id===id); if(r){ r.type=e.target.value; persist() } }
  })
  els.filter.addEventListener('input', renderSetup)

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
  function applyTemplate(key){
    const pool = (lang==='ar'? templatesAR : templatesEN);
    const nameMap = (lang==='ar'? gateNameMapAR : gateNameMapEN);
    const arr = pool[key]||[]; if(!arr.length){ alert(lang==='ar'? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø¨':'No items for this gate'); return; }
    const replace = confirm(lang==='ar'? 'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ù‚Ø§Ù„Ø¨ØŸ\nOK = Ø§Ø³ØªØ¨Ø¯Ø§Ù„\nCancel = Ø¥Ø¶Ø§ÙØ©' : 'Replace current list with template?\nOK = Replace\nCancel = Append');
    els.filter.value='';
    if(replace){ rows = [] }
    arr.forEach(t=> rows.push({id:uid(), text:t, include:true, type: defaultType()}));
    // ØªØ¹Ø¨Ø¦Ø© Ø±Ù‚Ù… ÙˆØ§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¯Ø§Ø¦Ù…Ù‹Ø§
    els.gateNo.value = gateNoMap[key] || els.gateNo.value;
    els.gateName.value = nameMap[key] || '';
    renderSetup(); persist();
    document.getElementById('tbody').scrollIntoView({behavior:'smooth', block:'start'});
    toast((lang==='ar'? 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ':'Loaded ')+arr.length+(lang==='ar'? ' Ø¨Ù†Ø¯Ù‹Ø§ Ù…Ù† ':' items from ')+ key.toUpperCase())
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ±Ø¬Ù… Ø¥Ù† ÙƒÙ†Ø§ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    if(!els.client.classList.contains('hidden')){
      els.titleTxt.textContent = i18n[lang].clientTitle(els.gateNo.value, els.gateName.value);
    }
  }
  S('[data-tpl]').forEach(btn=>{ btn.addEventListener('click',()=> applyTemplate(btn.getAttribute('data-tpl')) ) });

  // ØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚Ù„ "Ø£Ø®Ø±Ù‰" Ù„Ù„ÙˆØµÙ
  els.dDescSel.addEventListener('change',()=>{
    if(els.dDescSel.value==='__other') els.dDescOther.classList.remove('hidden');
    else { els.dDescOther.classList.add('hidden'); els.dDescOther.value=''; }
    persist();
  });

  // Ø­ÙØ¸/Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†/Ø·Ø¨Ø§Ø¹Ø©
  els.saveDraft.onclick=()=>{ persist(); alert(lang==='ar'? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§':'Draft saved locally') };
  els.reset.onclick=()=>{ if(confirm(lang==='ar'? 'Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ':'Clear all data?')){ localStorage.removeItem(LS_KEY); rows=[]; clientLogoData=''; brandLogoData=''; renderSetup(); els.dClient.value=els.dSite.value=els.gateNo.value=els.gateName.value=''; els.dDescSel.value=''; els.dDescOther.value=''; persist() } };
  els.printSetup.onclick=()=>{ window.print() };

  // Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
  els.preview.onclick=()=>{
    let list = rows.filter(r=>r.include && String(r.text||'').trim());
    if(!list.length && rows.length){ rows.forEach(r=>r.include=true); renderSetup(); persist(); list = rows.slice() }
    if(!list.length){ alert(lang==='ar'? 'Ø§Ø®ØªØ± Ø¨Ù†Ø¯Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„':'Select at least one item'); return }

    els.titleTxt.textContent = i18n[lang].clientTitle(els.gateNo.value, els.gateName.value);
    els.cClient.value = els.dClient.value; els.cSite.value = els.dSite.value;
    const desc = (els.dDescSel.value==='__other'? els.dDescOther.value : els.dDescSel.value) || '';
    els.cDesc.value = desc; document.getElementById('clientBody').innerHTML='';

    list.forEach((r,i)=>{
      const type = r.type||'yesno';
      let typeTxt = i18n[lang].type[type];
      let control = '';
      if(type==='yesno'){
        control = `<label style="margin-inline:6px"><input type="radio" name="r${i}" value="ok"> âœ”</label>
                   <label style="margin-inline:6px"><input type="radio" name="r${i}" value="no"> âœ–</label>`;
      } else if(type==='scale') {
        control = `<select><option value=""></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>`;
      } else {
        control = `<span class="muted">â€”</span>`;
      }
      const tr=document.createElement('tr');
      tr.innerHTML = `<td class="num">${i+1}</td>
                      <td>${escapeHtml(r.text)}</td>
                      <td style="text-align:center">${typeTxt}</td>
                      <td colspan="2" style="text-align:center">${control}</td>
                      <td><input type="text" maxlength="50" placeholder="${lang==='ar'?'Ø­ØªÙ‰ 50 Ø­Ø±ÙÙ‹Ø§':'Up to 50 chars'}"></td>`;
      els.clientBody.appendChild(tr)
    })

    // Ø§Ù„Ø´ÙØ¹Ø§Ø±Ø§Øª
    if(clientLogoData){ els.lg.src=clientLogoData; els.lg.hidden=false } else { els.lg.hidden=true }
    if(brandLogoData){ els.brandTop.src = brandLogoData }

    els.designer.classList.add('hidden'); els.client.classList.remove('hidden')
  }

  // HTML Ù†Ù‡Ø§Ø¦ÙŠ
  function buildClientHTMLByTypes(list, meta){
    const dict = i18n[lang];
    const rowsHtml = list.map((r,i)=>{
      const type = r.type||'yesno';
      let typeTxt = dict.type[type];
      let control = '';
      if(type==='yesno'){
        control = '<td style="text-align:center">â˜ âœ”</td><td style="text-align:center">â˜ âœ–</td>';
      } else if(type==='scale'){
        control = '<td colspan="2" style="text-align:center">1 2 3 4 5</td>';
      } else {
        control = '<td colspan="2" style="text-align:center">â€”</td>';
      }
      return `<tr><td style="text-align:center">${i+1}</td><td>${escapeHtml(r.text)}</td><td style="text-align:center">${typeTxt}</td>${control}<td></td></tr>`;
    }).join('');

    const clientLogo = clientLogoData? `<div style="text-align:center;margin-top:14px"><img src="${clientLogoData}" style="height:56px;object-fit:contain"></div>`:'';
    const brandTop = `<div style="text-align:end"><img alt="Ergonomic Industrial" src="${brandLogoData||'Arkonomic Industrial Safety-0411.png'}" style="height:50px"></div>`;
    const footer = `<div style="margin-top:14px;padding:10px 12px;border-top:1px solid #e5e7eb;color:#334155;font-size:12px;text-align:center">
      <div>Ergonomic Industrial â€” <a href="https://ergonomicindustrial.com" target="_blank">ergonomicindustrial.com</a></div>
      <div>Email: <a href="mailto:ergonomicindustrial@gmail.com">ergonomicindustrial@gmail.com</a> | Phone/WhatsApp: 67756743</div>
      ${clientLogo}
    </div>`;

    const htmlLang = dict.lang; const htmlDir = dict.dir;
    return `<!doctype html><html lang="${htmlLang}" dir="${htmlDir}"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${dict.clientTitle(meta.gateNo, meta.gateName)}</title>
<style>body{font-family:Tahoma,Arial;margin:0;background:#f7f8fb;color:#111;font-variant-numeric:lining-nums tabular-nums} .wrap{max-width:900px;margin:auto;padding:16px} .card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px} h2{text-align:center;margin:.2rem 0 .6rem} table{width:100%;border-collapse:collapse;margin-top:10px} th,td{border:1px solid #ccc;padding:8px;vertical-align:middle} th{background:#e6f0ff;text-align:center} a{color:#2563eb}</style></head>
<body><div class="wrap"><div class="card">${brandTop}
<h2>${dict.clientTitle(escapeHtml(meta.gateNo||'-'), escapeHtml(meta.gateName||''))}</h2>
<div style="margin:6px 0 10px;color:#333">${dict['field.company']}: ${escapeHtml(meta.client||'-')} | ${dict['field.site']}: ${escapeHtml(meta.site||'-')} | ${dict['field.desc']}: ${escapeHtml(meta.desc||'-')} | ${dict['field.issue']||'Issue'}: ${escapeHtml(meta.issue||'-')}</div>
<table><thead><tr><th>${dict['th.no']}</th><th>${dict['th.item']}</th><th>${dict['th.type']}</th><th colspan="2">${dict['th.field']}</th><th>${dict['th.note']}</th></tr></thead><tbody>${rowsHtml}</tbody></table>
${footer}
</div></div></body></html>`;
  }

  // ØªØµØ¯ÙŠØ± HTML
  els.exportHtml.onclick=()=>{
    const list = rows.filter(r=>r.include && String(r.text||'').trim());
    if(!list.length){ alert(lang==='ar'? 'Ø§Ø®ØªØ± Ø¨Ù†Ø¯Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„':'Select at least one item'); return }
    const desc = (els.dDescSel.value==='__other'? els.dDescOther.value : els.dDescSel.value) || '';
    const meta = { gateNo: els.gateNo.value, gateName: els.gateName.value, client: els.dClient.value, site: els.dSite.value, desc, issue: els.issueDate.value };
    const html = buildClientHTMLByTypes(list, meta);
    const fname = suggestFileName()+'.html';
    const blob=new Blob([html],{type:'text/html'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=fname; a.click(); URL.revokeObjectURL(url);
  }

  function suggestFileName(){
    const sanitize = s=>String(s||'').trim().replace(/\s+/g,'-').replace(/[^\w\-]/g,'');
    const parts=[ sanitize(els.dClient.value||'Client'), sanitize(els.dSite.value||'Site'), 'G'+sanitize(els.gateNo.value||'0'), (els.issueDate.value||today) ];
    return parts.filter(Boolean).join('_');
  }

  // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· (Ù‚Ø§Ù„Ø¨)
  els.makeLink.onclick=()=>{
    const fname = prompt(lang==='ar'? 'Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª ÙˆØ¨Ø¯ÙˆÙ† Ø§Ù…ØªØ¯Ø§Ø¯ .html):':'File name (no spaces, without .html):', suggestFileName()) || suggestFileName();
    const base = LINK_BASE.replace(/\/$/,'');
    const sub = LINK_SUBDIR? '/'+LINK_SUBDIR.replace(/^\//,'') : '';
    const url = `${base}${sub}/${fname}.html`;
    navigator.clipboard && navigator.clipboard.writeText(url).catch(()=>{});
    toast(lang==='ar'? 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· (Ù†ÙØ³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø©). ØªØ°ÙƒÙŠØ±: Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§Ø± Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·.' : 'Link created and copied. Reminder: upload the HTML to the same path.');
    alert((lang==='ar'? 'Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ù…ÙŠÙ„:\n':'Client link:\n')+url+"\n\n"+(lang==='ar'? '* ØªØ°ÙƒÙŠØ±: Ø§Ø±ÙØ¹ Ù…Ù„Ù HTML Ø¥Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ù„Ù‰ GitHub Pages Ø£Ùˆ Ù…ÙˆÙ‚Ø¹Ùƒ.':'* Reminder: upload the HTML file to the same path.'))
  }

  // Ø§Ù„Ø¹ÙˆØ¯Ø© ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©
  els.back.onclick=()=>{ els.client.classList.add('hidden'); els.designer.classList.remove('hidden') }
  els.printClient.onclick=()=>window.print()

  // Ù…Ø´Ø§Ø±ÙƒØ©
  function buildShareText(){
    const title = els.titleTxt.textContent || (lang==='ar'? 'Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø©':'Safety Audit');
    const company = els.cClient.value||els.dClient.value||'-';
    const site = els.cSite.value||els.dSite.value||'-';
    const g = (els.gateNo.value||'-')+ ' â€“ ' + (els.gateName.value||'');
    const date = els.cDate.value || els.issueDate.value || '';
    const fname = suggestFileName()+'.html';
    const base = LINK_BASE.replace(/\/$/,'');
    const sub = LINK_SUBDIR? '/'+LINK_SUBDIR.replace(/^\//,'') : '';
    const maybeURL = `${base}${sub}/${fname}`;
    const body = (lang==='ar'?
      `Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${title}\nØ§Ù„Ø´Ø±ÙƒØ©: ${company}\nØ§Ù„Ù…ÙˆÙ‚Ø¹: ${site}\nØ§Ù„Ø¨Ø§Ø¨: ${g}\nØ§Ù„ØªØ§Ø±ÙŠØ®: ${date}\n\nğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­: ${fname}\nğŸ”— Ø±Ø§Ø¨Ø· (Ø¥Ù† ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù): ${maybeURL}` :
      `Title: ${title}\nCompany: ${company}\nSite: ${site}\nGate: ${g}\nDate: ${date}\n\nğŸ“ Suggested filename: ${fname}\nğŸ”— Link (if uploaded): ${maybeURL}`);
    const subject = (lang==='ar'? `${company} | ${g} | ${date}` : `${company} | ${g} | ${date}`);
    return {subject, body}
  }
  els.sendWA.onclick=()=>{ const {body}=buildShareText(); const url = 'https://wa.me/?text='+encodeURIComponent(body); window.open(url,'_blank') }
  els.sendMail.onclick=()=>{ const {subject, body}=buildShareText(); const href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(`${body}\n\n* ${lang==='ar'? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù HTML Ø§Ù„Ù…ØµØ¯Ù‘ÙØ± ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.':'Please attach the exported HTML file.'}`)}`; window.location.href = href; }

  // Ù„ØºØ©
  els.langSel.addEventListener('change', ()=>{
    lang = els.langSel.value; applyI18n(); renderSetup(); persist();
  });

  // Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø¨ ÙŠØ¯ÙˆÙŠÙ‹Ø§
  els.gateNo.addEventListener('input', ()=>{
    const key = numToGateKey[String(els.gateNo.value||'').trim()];
    if(key){ const nameMap = (lang==='ar'? gateNameMapAR : gateNameMapEN); els.gateName.value = nameMap[key]||''; }
  });

  // ØªØ²Ø§Ù…Ù† Ø¹Ø§Ù…
  ;['input','change'].forEach(ev=>{ ['dClient','dSite','gateNo','gateName','issueDate','optChecks','optRisk','dDescSel','dDescOther'].forEach(id=>{ const el=els[id]; if(el) el.addEventListener(ev, persist) }) })

  // Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
  els.btnRunTests && els.btnRunTests.addEventListener('click',()=>{
    const logs=[]; const ok=(name,cond)=>logs.push((cond?'âœ… ':'âŒ ')+name+(cond?'':' (ÙØ´Ù„)'));
    const before=rows.length; applyTemplate('ch1'); const after=rows.length; ok('ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Ø¨Ø§Ø¨ 1 ÙŠØ¶ÙŠÙ Ø¹Ù†Ø§ØµØ±', after>before);
    els.preview.click(); ok('ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„', !els.client.classList.contains('hidden'));
    ok('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø±Ù‚Ù…/Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¨', /Gate|Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚/.test(els.titleTxt.textContent));
    const htmlNew = buildClientHTMLByTypes([{text:'Ø¨Ù†Ø¯ yes/no',type:'yesno'},{text:'Ø¨Ù†Ø¯ scale',type:'scale'},{text:'Ø¨Ù†Ø¯ note',type:'note'}], {gateNo:'2',gateName:'Ø§Ø®ØªØ¨Ø§Ø±2',client:'C',site:'S',desc:'D',issue:'2025-01-02'});
    ok('buildClientHTMLByTypes ÙŠØ­ØªÙˆÙŠ <!doctype html>', /^<!doctype html>/i.test(htmlNew));
    ok('Ø§Ù„ÙÙˆØªØ± ÙŠØ­ØªÙˆÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ØµØ­ÙŠØ­Ø©', /ergonomicindustrial\.com/.test(htmlNew) && /ergonomicindustrial@gmail\.com/.test(htmlNew) && /67756743/.test(htmlNew));
    ok('Ø¹Ø¯Ø¯ #lg2 ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·', document.querySelectorAll('#lg2').length===1);
    ok('Ø¹Ø¯Ø¯ #titleTxt ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·', document.querySelectorAll('#titleTxt').length===1);
    const {subject, body}= (function(){
      const title = els.titleTxt.textContent || 'Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø©';
      const company = els.cClient.value||els.dClient.value||'-';
      const site = els.cSite.value||els.dSite.value||'-';
      const g = (els.gateNo.value||'-')+ ' â€“ ' + (els.gateName.value||'');
      const date = els.cDate.value || els.issueDate.value || '';
      return {subject: `${company} | ${g} | ${date}`, body: `Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${title}\nØ§Ù„Ø´Ø±ÙƒØ©: ${company}\nØ§Ù„Ù…ÙˆÙ‚Ø¹: ${site}\nØ§Ù„Ø¨Ø§Ø¨: ${g}\nØ§Ù„ØªØ§Ø±ÙŠØ®: ${date}`}
    })();
    const href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(`${body}\n\n* Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù HTML Ø§Ù„Ù…ØµØ¯Ù‘ÙØ± ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.`)}`;
    ok('mailto ÙŠØ¨Ø¯Ø£ Ø¨ØµÙŠØºØ© ØµØ­ÙŠØ­Ø©', /^mailto:\?subject=/.test(href));
    ok('Ù„Ø§ ÙŠØ­ØªÙˆÙŠ href Ø¹Ù„Ù‰ Ù…Ø­Ø§Ø±Ù \\n Ø§Ù„Ø®Ø§Ù…', !/\n/.test(href));
    const htmlScale = buildClientHTMLByTypes([{text:'ØªÙ‚ÙŠÙŠÙ… Ù…Ù‚ÙŠØ§Ø³',type:'scale'}], {gateNo:'3',gateName:'Ø§Ø®ØªØ¨Ø§Ø±3',client:'A',site:'B',desc:'C',issue:'2025-01-03'});
    ok('Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ ÙŠØ¸Ù‡Ø± ÙƒØ³Ù„Ø³Ù„Ø© 1 2 3 4 5', /1\s2\s3\s4\s5/.test(htmlScale));
    document.getElementById('testOut').textContent = logs.join('\n');
  })

  function seed(){ if(rows.length) return; ['Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ù„ÙŠÙ„ Ø¥Ø±Ø´Ø§Ø¯ÙŠ Ù„Ù„Ø³Ù„Ø§Ù…Ø©','ØªØ­Ø¯ÙŠØ¯ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù…Ù„','ØªÙˆÙÙŠØ± Ù…Ø¹Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ©','ÙØ­Øµ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø¥Ø·ÙØ§Ø¡ ÙˆØµÙ„Ø§Ø­ÙŠØªÙ‡Ø§'].forEach(t=>addRow(t)) }
  restore(); seed(); applyI18n();
})();
</script>
</body>
</html>
